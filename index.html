<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>HenVerse â€” Egg Mining on The Grotto</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,700;0,9..144,900;1,9..144,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
/* â”€â”€â”€ DESIGN TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --yolk:       #F5A623;
  --yolk-deep:  #C8781A;
  --shell:      #FFF8E8;
  --coop-brown: #3D2008;
  --coop-mid:   #6B3A1F;
  --coop-light: #A0622A;
  --straw:      #E8C97A;
  --straw-pale: #F5EAC5;
  --green:      #5B8C3E;
  --green-pale: #C5DFB3;
  --red-warn:   #C0392B;
  --sky:        #D0EAF8;
  --ink:        #1A0D00;
  --ink-mid:    #4A2E10;
  --shadow:     rgba(61,32,8,.18);
  --glow:       rgba(245,166,35,.35);
  --radius:     14px;
  --radius-sm:  8px;
  --font-display: 'Fraunces', Georgia, serif;
  --font-mono:    'DM Mono', monospace;
}

/* â”€â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: var(--font-display);
  background: var(--coop-brown);
  color: var(--shell);
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

/* â”€â”€â”€ BACKGROUND TEXTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background:
    radial-gradient(ellipse 80% 60% at 50% -10%, #6B3A1F 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 100% 100%, #A0622A22 0%, transparent 60%),
    repeating-linear-gradient(
      45deg,
      transparent,
      transparent 18px,
      rgba(160,98,42,.07) 18px,
      rgba(160,98,42,.07) 19px
    );
  pointer-events: none;
}

/* Grain overlay */
body::after {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events: none;
  opacity: .5;
}

/* â”€â”€â”€ FLOATING BITS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.floaters { position: fixed; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
.floater {
  position: absolute;
  font-size: 1.4rem;
  opacity: .18;
  animation: drift linear infinite;
}
@keyframes drift {
  0%   { transform: translateY(110vh) rotate(0deg);   opacity: .0; }
  10%  { opacity: .18; }
  90%  { opacity: .18; }
  100% { transform: translateY(-10vh)  rotate(360deg); opacity: .0; }
}

/* â”€â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app { position: relative; z-index: 2; min-height: 100vh; display: flex; flex-direction: column; }

/* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header {
  display: flex; align-items: center; gap: 1.5rem;
  padding: 1.1rem 2rem;
  background: rgba(61,32,8,.78);
  backdrop-filter: blur(14px);
  border-bottom: 2px solid var(--coop-light);
  position: sticky; top: 0; z-index: 100;
  flex-wrap: wrap;
}
.logo {
  display: flex; align-items: center; gap: .75rem;
  flex-shrink: 0;
}
.logo-egg {
  font-size: 2.2rem;
  filter: drop-shadow(0 0 12px var(--yolk));
  animation: pulse-egg 3s ease-in-out infinite;
}
@keyframes pulse-egg {
  0%,100% { filter: drop-shadow(0 0 10px var(--yolk)); transform: scale(1); }
  50%      { filter: drop-shadow(0 0 22px var(--yolk)); transform: scale(1.07); }
}
.logo-text h1 {
  font-family: var(--font-display);
  font-weight: 900;
  font-size: 1.55rem;
  color: var(--yolk);
  letter-spacing: -.02em;
  line-height: 1;
}
.logo-text p {
  font-size: .72rem;
  font-family: var(--font-mono);
  color: var(--straw);
  letter-spacing: .08em;
  opacity: .8;
}

nav { display: flex; gap: .5rem; flex: 1; justify-content: center; flex-wrap: wrap; }
.nav-btn {
  background: none;
  border: 1.5px solid transparent;
  color: var(--straw-pale);
  font-family: var(--font-display);
  font-weight: 700;
  font-size: .9rem;
  padding: .45rem 1.1rem;
  border-radius: 999px;
  cursor: pointer;
  transition: all .2s;
  letter-spacing: .01em;
}
.nav-btn:hover { border-color: var(--straw); color: var(--shell); }
.nav-btn.active {
  background: var(--yolk);
  border-color: var(--yolk);
  color: var(--coop-brown);
}

.wallet-zone { display: flex; align-items: center; gap: .75rem; flex-shrink: 0; }
#connect-btn {
  background: linear-gradient(135deg, var(--yolk), var(--yolk-deep));
  border: none;
  color: var(--coop-brown);
  font-family: var(--font-display);
  font-weight: 700;
  font-size: .9rem;
  padding: .5rem 1.4rem;
  border-radius: 999px;
  cursor: pointer;
  box-shadow: 0 3px 14px var(--glow);
  transition: transform .15s, box-shadow .15s;
}
#connect-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px var(--glow); }
#connect-btn:active { transform: translateY(0); }
#wallet-badge {
  display: none;
  align-items: center; gap: .5rem;
  background: rgba(245,166,35,.15);
  border: 1.5px solid var(--yolk);
  border-radius: 999px;
  padding: .35rem .9rem;
  font-family: var(--font-mono);
  font-size: .82rem;
  color: var(--yolk);
}
#wallet-badge .dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: #4CAF50;
  box-shadow: 0 0 6px #4CAF50;
  flex-shrink: 0;
}

/* â”€â”€â”€ STATUS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#status-bar {
  display: none;
  background: rgba(200,120,26,.25);
  border-bottom: 1px solid var(--yolk-deep);
  padding: .55rem 2rem;
  font-family: var(--font-mono);
  font-size: .82rem;
  color: var(--straw);
  text-align: center;
  z-index: 99;
}
#status-bar.error { background: rgba(192,57,43,.25); border-color: var(--red-warn); color: #f8a5a0; }
#status-bar.visible { display: block; }

/* â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
main { flex: 1; padding: 2rem; max-width: 1300px; margin: 0 auto; width: 100%; }

/* Tabs */
.tab-panel { display: none; animation: fadeIn .3s ease; }
.tab-panel.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }

/* â”€â”€â”€ SECTION TITLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-title {
  font-size: 1.6rem;
  font-weight: 900;
  color: var(--yolk);
  margin-bottom: 1.5rem;
  display: flex; align-items: center; gap: .6rem;
}
.section-title span { font-size: 1.8rem; }

/* â”€â”€â”€ COOP TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#tab-coop { display: grid; grid-template-columns: 320px 1fr; gap: 2rem; align-items: start; }
@media(max-width:900px) { #tab-coop { grid-template-columns: 1fr; } }

/* Facility Card */
.facility-card {
  background: linear-gradient(160deg, rgba(107,58,31,.85), rgba(61,32,8,.95));
  border: 2px solid var(--coop-light);
  border-radius: var(--radius);
  padding: 1.5rem;
  box-shadow: 0 8px 32px var(--shadow);
  position: sticky; top: 90px;
}
.facility-card h2 { font-size: 1.2rem; font-weight: 900; color: var(--yolk); margin-bottom: 1rem; }
.facility-art {
  width: 100%;
  aspect-ratio: 4/3;
  background: linear-gradient(180deg, var(--sky) 0%, var(--green-pale) 60%, var(--green) 100%);
  border-radius: var(--radius-sm);
  overflow: hidden;
  position: relative;
  margin-bottom: 1rem;
  border: 2px solid var(--coop-light);
}
/* SVG coop illustration */
.facility-art svg { width: 100%; height: 100%; }

.stats-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: .6rem; margin-bottom: 1rem;
}
.stat-box {
  background: rgba(245,166,35,.1);
  border: 1px solid rgba(245,166,35,.2);
  border-radius: var(--radius-sm);
  padding: .65rem .9rem;
}
.stat-box .label {
  font-family: var(--font-mono);
  font-size: .68rem;
  letter-spacing: .06em;
  color: var(--straw);
  margin-bottom: .2rem;
  text-transform: uppercase;
}
.stat-box .value { font-size: 1.05rem; font-weight: 900; color: var(--yolk); }

.coop-btn {
  width: 100%;
  background: linear-gradient(135deg, var(--yolk), var(--yolk-deep));
  border: none;
  color: var(--coop-brown);
  font-family: var(--font-display);
  font-weight: 900;
  font-size: 1rem;
  padding: .75rem;
  border-radius: var(--radius-sm);
  cursor: pointer;
  box-shadow: 0 4px 18px var(--glow);
  transition: transform .15s, box-shadow .15s;
  margin-top: .4rem;
}
.coop-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px var(--glow); }
.coop-btn:disabled {
  opacity: .5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}
.coop-btn.secondary {
  background: transparent;
  border: 2px solid var(--coop-light);
  color: var(--straw);
  box-shadow: none;
  margin-top: .5rem;
}
.coop-btn.secondary:hover { border-color: var(--yolk); color: var(--yolk); background: rgba(245,166,35,.08); }

/* NFT Grid */
.nft-section { }
.nft-controls {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 1.2rem; gap: 1rem; flex-wrap: wrap;
}
.nft-count {
  font-family: var(--font-mono);
  font-size: .82rem;
  color: var(--straw);
}
.nft-count strong { color: var(--yolk); font-size: 1.1rem; }

.refresh-btn {
  background: transparent;
  border: 1.5px solid var(--coop-light);
  color: var(--straw);
  font-family: var(--font-mono);
  font-size: .78rem;
  padding: .35rem .85rem;
  border-radius: 999px;
  cursor: pointer;
  transition: all .2s;
  letter-spacing: .04em;
}
.refresh-btn:hover { border-color: var(--yolk); color: var(--yolk); }
.refresh-btn.spinning { animation: spin .8s linear infinite; pointer-events: none; }
@keyframes spin { to { transform: rotate(360deg); } }

/* NFT Grid */
.nft-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
  gap: 1rem;
}
.nft-card {
  background: linear-gradient(160deg, rgba(107,58,31,.7), rgba(61,32,8,.9));
  border: 1.5px solid var(--coop-mid);
  border-radius: var(--radius);
  overflow: hidden;
  cursor: pointer;
  transition: transform .2s, border-color .2s, box-shadow .2s;
  position: relative;
}
.nft-card:hover {
  transform: translateY(-4px);
  border-color: var(--yolk);
  box-shadow: 0 8px 28px var(--glow);
}
.nft-card.selected {
  border-color: var(--yolk);
  box-shadow: 0 0 0 3px rgba(245,166,35,.4), 0 8px 28px var(--glow);
}
.nft-card img {
  width: 100%; aspect-ratio: 1;
  object-fit: cover;
  display: block;
  background: var(--coop-brown);
}
.nft-card .nft-img-placeholder {
  width: 100%; aspect-ratio: 1;
  display: flex; align-items: center; justify-content: center;
  font-size: 3rem;
  background: linear-gradient(135deg, #4A2E10, #3D2008);
  color: var(--yolk);
}
.nft-card .nft-info {
  padding: .65rem .8rem;
}
.nft-card .nft-name {
  font-weight: 700;
  font-size: .88rem;
  color: var(--shell);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.nft-card .nft-id {
  font-family: var(--font-mono);
  font-size: .72rem;
  color: var(--straw);
  opacity: .7;
  margin-top: .15rem;
}
.nft-card .nft-badge {
  position: absolute;
  top: .5rem; right: .5rem;
  background: var(--green);
  color: #fff;
  font-family: var(--font-mono);
  font-size: .65rem;
  padding: .15rem .45rem;
  border-radius: 999px;
  font-weight: 500;
}
.nft-card .nft-badge.placed { background: var(--yolk-deep); }

/* Empty / Loading states */
.empty-state {
  grid-column: 1/-1;
  text-align: center;
  padding: 3rem 1rem;
  color: var(--straw);
  opacity: .6;
}
.empty-state .big { font-size: 3.5rem; margin-bottom: .75rem; }
.empty-state p { font-size: .95rem; }

.skeleton {
  background: linear-gradient(90deg, rgba(107,58,31,.5) 25%, rgba(160,98,42,.5) 50%, rgba(107,58,31,.5) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.4s infinite;
  border-radius: var(--radius);
  aspect-ratio: 1;
}
@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

/* â”€â”€â”€ POWER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.power-bar-wrap {
  margin: 1rem 0;
}
.power-bar-label {
  display: flex; justify-content: space-between;
  font-family: var(--font-mono); font-size: .73rem;
  color: var(--straw); margin-bottom: .35rem;
}
.power-bar-track {
  height: 10px;
  background: rgba(255,255,255,.1);
  border-radius: 999px;
  overflow: hidden;
}
.power-bar-fill {
  height: 100%;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--green), var(--yolk));
  transition: width .5s ease;
}
.power-bar-fill.warn { background: linear-gradient(90deg, var(--yolk), #e67e22); }
.power-bar-fill.danger { background: linear-gradient(90deg, #e67e22, var(--red-warn)); }

/* â”€â”€â”€ HOLDERS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.holders-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;
}
.holders-meta {
  display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem;
}
.holders-meta-card {
  background: linear-gradient(160deg, rgba(107,58,31,.7), rgba(61,32,8,.9));
  border: 1.5px solid var(--coop-mid);
  border-radius: var(--radius-sm);
  padding: .9rem 1.2rem;
  flex: 1; min-width: 140px;
}
.holders-meta-card .label {
  font-family: var(--font-mono); font-size: .68rem;
  letter-spacing: .07em; text-transform: uppercase;
  color: var(--straw); margin-bottom: .3rem;
}
.holders-meta-card .value {
  font-size: 1.6rem; font-weight: 900; color: var(--yolk); line-height: 1;
}

.holders-table-wrap {
  background: linear-gradient(160deg, rgba(107,58,31,.7), rgba(61,32,8,.9));
  border: 1.5px solid var(--coop-mid);
  border-radius: var(--radius);
  overflow: hidden;
}
.holders-search {
  display: flex; align-items: center; gap: .75rem;
  padding: 1rem 1.2rem;
  border-bottom: 1px solid rgba(160,98,42,.3);
}
.holders-search input {
  flex: 1;
  background: rgba(0,0,0,.25);
  border: 1.5px solid var(--coop-mid);
  border-radius: var(--radius-sm);
  color: var(--shell);
  font-family: var(--font-mono);
  font-size: .82rem;
  padding: .5rem .85rem;
  outline: none;
  transition: border-color .2s;
}
.holders-search input::placeholder { color: var(--coop-light); }
.holders-search input:focus { border-color: var(--yolk); }
.holders-search .search-icon { color: var(--straw); font-size: 1rem; flex-shrink: 0; }

.holders-table {
  width: 100%;
  border-collapse: collapse;
}
.holders-table th {
  text-align: left;
  font-family: var(--font-mono);
  font-size: .7rem;
  letter-spacing: .07em;
  text-transform: uppercase;
  color: var(--straw);
  padding: .75rem 1.2rem;
  border-bottom: 1px solid rgba(160,98,42,.3);
  background: rgba(61,32,8,.4);
  cursor: pointer;
  user-select: none;
  white-space: nowrap;
}
.holders-table th:hover { color: var(--yolk); }
.holders-table th .sort-arrow { opacity: .4; margin-left: .3rem; }
.holders-table th.sorted .sort-arrow { opacity: 1; color: var(--yolk); }

.holders-table td {
  padding: .7rem 1.2rem;
  border-bottom: 1px solid rgba(160,98,42,.12);
  font-family: var(--font-mono);
  font-size: .82rem;
  color: var(--shell);
  vertical-align: middle;
}
.holders-table tr:last-child td { border-bottom: none; }
.holders-table tr:hover td { background: rgba(245,166,35,.05); }
.holders-table tr.is-connected td { background: rgba(245,166,35,.08); }
.holders-table tr.is-connected td:first-child { border-left: 3px solid var(--yolk); }

.rank-num {
  color: var(--straw); opacity: .5; font-size: .75rem; min-width: 28px; display: inline-block;
}
.rank-num.top3 { color: var(--yolk); opacity: 1; font-weight: 700; font-size: .85rem; }

.addr-cell { display: flex; align-items: center; gap: .6rem; }
.addr-avatar {
  width: 28px; height: 28px; border-radius: 50%;
  flex-shrink: 0; font-size: 1rem;
  display: flex; align-items: center; justify-content: center;
  background: linear-gradient(135deg, var(--coop-mid), var(--coop-brown));
  border: 1.5px solid var(--coop-light);
}
.addr-text { display: flex; flex-direction: column; gap: .1rem; }
.addr-full {
  font-size: .78rem;
  color: var(--shell);
  letter-spacing: .02em;
}
.addr-short { display: none; }
.you-tag {
  font-size: .6rem; background: var(--yolk); color: var(--coop-brown);
  padding: .05rem .35rem; border-radius: 999px; font-weight: 700;
  letter-spacing: .04em; align-self: flex-start;
}
.copy-btn {
  background: none; border: none; cursor: pointer;
  color: var(--coop-light); font-size: .85rem;
  transition: color .15s; padding: .1rem;
}
.copy-btn:hover { color: var(--yolk); }

.token-chips {
  display: flex; flex-wrap: wrap; gap: .3rem; max-width: 320px;
}
.token-chip {
  background: rgba(245,166,35,.12);
  border: 1px solid rgba(245,166,35,.22);
  border-radius: 5px;
  padding: .12rem .4rem;
  font-size: .7rem;
  color: var(--straw);
  white-space: nowrap;
  cursor: pointer;
  transition: all .15s;
}
.token-chip:hover { background: rgba(245,166,35,.25); color: var(--yolk); }

.holders-count-badge {
  display: inline-flex; align-items: center; justify-content: center;
  background: rgba(245,166,35,.18);
  border: 1px solid rgba(245,166,35,.3);
  color: var(--yolk);
  font-family: var(--font-mono);
  font-size: .82rem;
  font-weight: 700;
  border-radius: 999px;
  padding: .25rem .85rem;
  min-width: 60px;
}

.scan-progress {
  padding: 1.5rem;
  text-align: center;
}
.scan-progress .progress-label {
  font-family: var(--font-mono);
  font-size: .82rem;
  color: var(--straw);
  margin-bottom: .75rem;
}
.progress-track {
  height: 8px;
  background: rgba(255,255,255,.1);
  border-radius: 999px;
  overflow: hidden;
  margin-bottom: .5rem;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--yolk-deep), var(--yolk));
  border-radius: 999px;
  transition: width .3s ease;
}
.scan-sub { font-family: var(--font-mono); font-size: .72rem; color: var(--coop-light); }

.holders-load-btn {
  background: linear-gradient(135deg, var(--yolk), var(--yolk-deep));
  border: none;
  color: var(--coop-brown);
  font-family: var(--font-display);
  font-weight: 900;
  font-size: .95rem;
  padding: .65rem 1.8rem;
  border-radius: 999px;
  cursor: pointer;
  box-shadow: 0 4px 18px var(--glow);
  transition: transform .15s, box-shadow .15s;
}
.holders-load-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px var(--glow); }
.holders-load-btn:disabled { opacity: .5; cursor: not-allowed; transform: none; }

.pagination {
  display: flex; align-items: center; justify-content: center;
  gap: .5rem; padding: 1rem;
  border-top: 1px solid rgba(160,98,42,.2);
  flex-wrap: wrap;
}
.page-btn {
  background: transparent;
  border: 1.5px solid var(--coop-mid);
  color: var(--straw);
  font-family: var(--font-mono);
  font-size: .78rem;
  padding: .35rem .75rem;
  border-radius: 6px;
  cursor: pointer;
  transition: all .15s;
}
.page-btn:hover { border-color: var(--yolk); color: var(--yolk); }
.page-btn.active { background: var(--yolk); border-color: var(--yolk); color: var(--coop-brown); font-weight: 700; }
.page-btn:disabled { opacity: .3; cursor: not-allowed; }

@media(max-width: 700px) {
  .addr-full { display: none; }
  .addr-short { display: block; font-size: .78rem; color: var(--shell); }
  .token-chips { display: none; }
}

/* â”€â”€â”€ TOKENOMICS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toko-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 1.2rem;
  margin-bottom: 2rem;
}
.toko-card {
  background: linear-gradient(160deg, rgba(107,58,31,.7), rgba(61,32,8,.9));
  border: 1.5px solid var(--coop-mid);
  border-radius: var(--radius);
  padding: 1.4rem;
}
.toko-card h3 {
  font-size: .78rem;
  font-family: var(--font-mono);
  letter-spacing: .08em;
  text-transform: uppercase;
  color: var(--straw);
  margin-bottom: .6rem;
}
.toko-card .big-num {
  font-size: 1.9rem;
  font-weight: 900;
  color: var(--yolk);
  line-height: 1;
}
.toko-card .sub-num { font-size: .82rem; color: var(--straw); margin-top: .3rem; }

.emission-table {
  width: 100%;
  border-collapse: collapse;
  font-family: var(--font-mono);
  font-size: .82rem;
  margin-top: .5rem;
}
.emission-table th {
  text-align: left;
  color: var(--straw);
  padding: .5rem .75rem;
  border-bottom: 1px solid rgba(160,98,42,.4);
  font-size: .72rem;
  letter-spacing: .06em;
  text-transform: uppercase;
}
.emission-table td {
  padding: .55rem .75rem;
  border-bottom: 1px solid rgba(160,98,42,.15);
  color: var(--shell);
}
.emission-table tr:last-child td { border-bottom: none; }
.emission-table .highlight { color: var(--yolk); font-weight: 700; }
.emission-table tr.current-era { background: rgba(245,166,35,.08); }

/* â”€â”€â”€ MARKET TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.market-notice {
  background: linear-gradient(160deg, rgba(107,58,31,.7), rgba(61,32,8,.9));
  border: 1.5px solid var(--coop-mid);
  border-radius: var(--radius);
  padding: 2rem;
  text-align: center;
  color: var(--straw);
}
.market-notice .big { font-size: 3rem; margin-bottom: .5rem; }
.market-notice h3 { font-size: 1.3rem; font-weight: 900; color: var(--yolk); margin-bottom: .5rem; }
.market-notice p { opacity: .75; line-height: 1.7; }

/* â”€â”€â”€ NFT DETAIL MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#modal-overlay {
  display: none;
  position: fixed; inset: 0; z-index: 200;
  background: rgba(30,12,0,.8);
  backdrop-filter: blur(8px);
  align-items: center; justify-content: center;
  padding: 1rem;
}
#modal-overlay.open { display: flex; }
.modal {
  background: linear-gradient(160deg, #4A2E10, #2A1500);
  border: 2px solid var(--coop-light);
  border-radius: var(--radius);
  max-width: 480px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,.6);
  animation: popIn .25s cubic-bezier(.34,1.56,.64,1);
}
@keyframes popIn {
  from { transform: scale(.88); opacity: 0; }
  to   { transform: scale(1);   opacity: 1; }
}
.modal-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 1.2rem 1.5rem;
  border-bottom: 1px solid var(--coop-mid);
}
.modal-header h3 { font-size: 1.15rem; font-weight: 900; color: var(--yolk); }
.modal-close {
  background: none; border: none; color: var(--straw);
  font-size: 1.4rem; cursor: pointer; line-height: 1;
  transition: color .15s;
}
.modal-close:hover { color: var(--yolk); }
.modal-body { padding: 1.5rem; }
.modal-img {
  width: 100%; border-radius: var(--radius-sm);
  margin-bottom: 1rem;
  border: 2px solid var(--coop-mid);
}
.modal-img-placeholder {
  width: 100%; aspect-ratio: 1;
  display: flex; align-items: center; justify-content: center;
  font-size: 5rem;
  background: var(--coop-brown);
  border-radius: var(--radius-sm);
  margin-bottom: 1rem;
  border: 2px solid var(--coop-mid);
}
.modal-attrs {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: .5rem; margin-bottom: 1rem;
}
.attr-pill {
  background: rgba(245,166,35,.1);
  border: 1px solid rgba(245,166,35,.2);
  border-radius: var(--radius-sm);
  padding: .5rem .75rem;
  font-family: var(--font-mono);
}
.attr-pill .attr-type {
  font-size: .65rem; letter-spacing: .06em; text-transform: uppercase;
  color: var(--straw); margin-bottom: .2rem;
}
.attr-pill .attr-val { font-size: .88rem; color: var(--shell); font-weight: 700; }
.modal-desc { font-size: .88rem; color: var(--straw); line-height: 1.7; margin-bottom: 1rem; }
.modal-link {
  display: inline-block;
  font-family: var(--font-mono);
  font-size: .78rem;
  color: var(--yolk);
  text-decoration: none;
  border: 1px solid rgba(245,166,35,.3);
  padding: .35rem .75rem;
  border-radius: 999px;
  transition: all .2s;
  margin-top: .25rem;
}
.modal-link:hover { background: rgba(245,166,35,.15); border-color: var(--yolk); }

/* â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
footer {
  display: flex; align-items: center; justify-content: center; gap: 2rem;
  padding: 1rem 2rem;
  border-top: 1px solid rgba(160,98,42,.3);
  font-family: var(--font-mono);
  font-size: .74rem;
  color: var(--coop-light);
  flex-wrap: wrap;
}
footer a { color: var(--yolk); text-decoration: none; }
footer a:hover { text-decoration: underline; }

/* â”€â”€â”€ CHAIN BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chain-badge {
  display: inline-flex; align-items: center; gap: .4rem;
  background: rgba(245,166,35,.12);
  border: 1px solid rgba(245,166,35,.25);
  padding: .2rem .65rem;
  border-radius: 999px;
  font-family: var(--font-mono);
  font-size: .72rem;
  color: var(--straw);
  white-space: nowrap;
}
.chain-badge .chain-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 5px var(--green);
}
</style>
</head>
<body>

<!-- Floating ambient feathers/eggs -->
<div class="floaters" id="floaters"></div>

<div id="app">
  <!-- â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header>
    <div class="logo">
      <div class="logo-egg">ğŸ¥š</div>
      <div class="logo-text">
        <h1>HenVerse</h1>
        <p>EGG MINING Â· THE GROTTO</p>
      </div>
    </div>

    <nav>
      <button class="nav-btn active" onclick="switchTab('coop')">ğŸ” My Coop</button>
      <button class="nav-btn" onclick="switchTab('holders')">ğŸ‘¥ Holders</button>
      <button class="nav-btn" onclick="switchTab('tokenomics')">ğŸ“Š Tokenomics</button>
      <button class="nav-btn" onclick="switchTab('market')">ğŸ›’ Market</button>
    </nav>

    <div class="wallet-zone">
      <div class="chain-badge">
        <span class="chain-dot"></span>
        The Grotto
      </div>
      <div id="wallet-badge">
        <span class="dot"></span>
        <span id="wallet-addr"></span>
      </div>
      <button id="connect-btn" onclick="connectWallet()">Connect Wallet</button>
    </div>
  </header>

  <!-- â”€â”€â”€ STATUS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="status-bar"></div>

  <!-- â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main>

    <!-- COOP TAB -->
    <div id="tab-coop" class="tab-panel active">
      <div class="facility-card">
        <h2>ğŸ¡ Your Hen Coop</h2>
        <!-- Coop SVG illustration -->
        <div class="facility-art">
          <svg viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
            <!-- Sky -->
            <rect width="400" height="300" fill="#D0EAF8"/>
            <!-- Ground -->
            <rect y="220" width="400" height="80" fill="#5B8C3E"/>
            <rect y="200" width="400" height="30" fill="#7AB050"/>
            <!-- Coop body -->
            <rect x="60" y="100" width="260" height="130" rx="4" fill="#8B5A2B"/>
            <rect x="65" y="105" width="250" height="120" rx="3" fill="#A0622A"/>
            <!-- Roof -->
            <polygon points="40,105 200,30 360,105" fill="#6B3A1F"/>
            <polygon points="50,105 200,38 350,105" fill="#8B4513"/>
            <!-- Roof ridge -->
            <line x1="200" y1="32" x2="200" y2="105" stroke="#6B3A1F" stroke-width="3"/>
            <!-- Roof tiles pattern -->
            <g opacity="0.2">
              <line x1="120" y1="105" x2="155" y2="60" stroke="#3D2008" stroke-width="1.5"/>
              <line x1="160" y1="105" x2="178" y2="47" stroke="#3D2008" stroke-width="1.5"/>
              <line x1="200" y1="105" x2="200" y2="38" stroke="#3D2008" stroke-width="1.5"/>
              <line x1="240" y1="105" x2="222" y2="47" stroke="#3D2008" stroke-width="1.5"/>
              <line x1="280" y1="105" x2="245" y2="60" stroke="#3D2008" stroke-width="1.5"/>
            </g>
            <!-- Door -->
            <rect x="172" y="165" width="56" height="65" rx="6" fill="#3D2008"/>
            <rect x="175" y="168" width="50" height="59" rx="4" fill="#2A1400"/>
            <circle cx="218" cy="198" r="3" fill="#F5A623"/>
            <!-- Windows -->
            <rect x="82" y="122" width="60" height="50" rx="4" fill="#3D2008"/>
            <rect x="85" y="125" width="54" height="44" rx="3" fill="#87CEEB" opacity="0.8"/>
            <line x1="112" y1="125" x2="112" y2="169" stroke="#3D2008" stroke-width="2"/>
            <line x1="85"  y1="147" x2="139" y2="147" stroke="#3D2008" stroke-width="2"/>

            <rect x="252" y="122" width="60" height="50" rx="4" fill="#3D2008"/>
            <rect x="255" y="125" width="54" height="44" rx="3" fill="#87CEEB" opacity="0.8"/>
            <line x1="282" y1="125" x2="282" y2="169" stroke="#3D2008" stroke-width="2"/>
            <line x1="255" y1="147" x2="309" y2="147" stroke="#3D2008" stroke-width="2"/>

            <!-- Fence left -->
            <rect x="10" y="195" width="55" height="8" rx="2" fill="#8B5A2B"/>
            <rect x="15" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <rect x="35" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <rect x="55" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <!-- Fence right -->
            <rect x="340" y="195" width="55" height="8" rx="2" fill="#8B5A2B"/>
            <rect x="340" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <rect x="360" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <rect x="380" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <!-- Chickens -->
            <!-- Chicken 1 -->
            <ellipse cx="330" cy="218" rx="18" ry="14" fill="#F5F5DC"/>
            <circle cx="346" cy="210" r="9" fill="#F5F5DC"/>
            <ellipse cx="351" cy="208" rx="4" ry="3" fill="#FF6B6B"/>
            <polygon points="356,210 362,212 356,214" fill="#F5A623"/>
            <circle cx="353" cy="208" r="1.5" fill="#2A1400"/>
            <!-- Chicken 2 -->
            <ellipse cx="60" cy="218" rx="16" ry="13" fill="#FFF8DC"/>
            <circle cx="44" cy="210" r="8" fill="#FFF8DC"/>
            <ellipse cx="39" cy="208" rx="3.5" ry="2.5" fill="#FF6B6B"/>
            <polygon points="34,210 28,212 34,214" fill="#F5A623"/>
            <circle cx="37" cy="208" r="1.5" fill="#2A1400"/>
            <!-- Eggs on ground -->
            <ellipse cx="160" cy="225" rx="8" ry="6" fill="#FFF8DC" stroke="#E8C97A" stroke-width="1"/>
            <ellipse cx="175" cy="230" rx="7" ry="5.5" fill="#F5EAC5" stroke="#E8C97A" stroke-width="1"/>
            <ellipse cx="240" cy="227" rx="8" ry="6" fill="#FFF8DC" stroke="#E8C97A" stroke-width="1"/>
            <!-- Sun -->
            <circle cx="360" cy="45" r="22" fill="#F5A623" opacity="0.9"/>
            <g stroke="#F5A623" stroke-width="2" opacity="0.6">
              <line x1="360" y1="15" x2="360" y2="8"/>
              <line x1="360" y1="75" x2="360" y2="82"/>
              <line x1="330" y1="45" x2="323" y2="45"/>
              <line x1="390" y1="45" x2="397" y2="45"/>
              <line x1="339" y1="24" x2="334" y2="19"/>
              <line x1="381" y1="66" x2="386" y2="71"/>
              <line x1="381" y1="24" x2="386" y2="19"/>
              <line x1="339" y1="66" x2="334" y2="71"/>
            </g>
          </svg>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-box">
            <div class="label">Hens Owned</div>
            <div class="value" id="stat-hens">â€”</div>
          </div>
          <div class="stat-box">
            <div class="label">Placed in Coop</div>
            <div class="value" id="stat-placed">0</div>
          </div>
          <div class="stat-box">
            <div class="label">Hashrate</div>
            <div class="value" id="stat-hashrate">0 MH/s</div>
          </div>
          <div class="stat-box">
            <div class="label">Power</div>
            <div class="value" id="stat-power">0W</div>
          </div>
        </div>

        <!-- Power Bar -->
        <div class="power-bar-wrap">
          <div class="power-bar-label">
            <span>Power Usage</span>
            <span id="power-label-val">0 / 2000W</span>
          </div>
          <div class="power-bar-track">
            <div class="power-bar-fill" id="power-bar" style="width:0%"></div>
          </div>
        </div>

        <div id="no-wallet-msg" style="text-align:center;color:var(--straw);font-size:.85rem;padding:.5rem 0;opacity:.7;">
          Connect your wallet to manage your coop
        </div>

        <button class="coop-btn secondary" id="refresh-nfts-btn" style="display:none" onclick="loadNFTs()">
          â†» Refresh Hens
        </button>
      </div>

      <!-- NFT Grid Panel -->
      <div class="nft-section">
        <div class="nft-controls">
          <div>
            <div class="section-title" style="margin-bottom:.25rem;">
              <span>ğŸ£</span> HenVerse NFTs
            </div>
            <div class="nft-count" id="nft-count-label">Connect wallet to see your hens</div>
          </div>
          <button class="refresh-btn" id="refresh-btn" onclick="loadNFTs()" style="display:none">â†» Refresh</button>
        </div>

        <div class="nft-grid" id="nft-grid">
          <div class="empty-state">
            <div class="big">ğŸšï¸</div>
            <p>Connect your wallet to see your HenVerse hens</p>
          </div>
        </div>
      </div>
    </div>

    <!-- TOKENOMICS TAB -->
    <div id="tab-tokenomics" class="tab-panel">
      <div class="section-title"><span>ğŸ“Š</span> EGG Token Tokenomics</div>
      <div class="toko-grid">
        <div class="toko-card">
          <h3>Max Supply</h3>
          <div class="big-num">21,000,000</div>
          <div class="sub-num">EGG â€” fixed hard cap</div>
        </div>
        <div class="toko-card">
          <h3>Premine / Team</h3>
          <div class="big-num" style="color:var(--green)">None</div>
          <div class="sub-num">100% gameplay emissions</div>
        </div>
        <div class="toko-card">
          <h3>Base Emission Rate</h3>
          <div class="big-num">2.5</div>
          <div class="sub-num">EGG per block</div>
        </div>
        <div class="toko-card">
          <h3>Halving Interval</h3>
          <div class="big-num">4.2M</div>
          <div class="sub-num">blocks â‰ˆ 48 days</div>
        </div>
        <div class="toko-card">
          <h3>Referral Fee</h3>
          <div class="big-num">2.5%</div>
          <div class="sub-num">of claimed rewards</div>
        </div>
        <div class="toko-card">
          <h3>Network</h3>
          <div class="big-num" style="font-size:1.2rem">The Grotto</div>
          <div class="sub-num">Chain ID 36463 Â· Avalanche L1</div>
        </div>
      </div>

      <div class="section-title" style="margin-top:1.5rem"><span>â³</span> Emission Schedule</div>
      <div style="background:linear-gradient(160deg,rgba(107,58,31,.7),rgba(61,32,8,.9));border:1.5px solid var(--coop-mid);border-radius:var(--radius);padding:1.2rem;overflow-x:auto;">
        <table class="emission-table" id="emission-table">
          <thead>
            <tr>
              <th>Era</th>
              <th>Blocks</th>
              <th>Rate (EGG/block)</th>
              <th>Era Supply</th>
              <th>Cumulative</th>
              <th>â‰ˆ Days</th>
            </tr>
          </thead>
          <tbody id="emission-tbody"></tbody>
        </table>
      </div>

      <div class="section-title" style="margin-top:1.5rem"><span>ğŸ”</span> Reward Flywheel</div>
      <div style="background:linear-gradient(160deg,rgba(107,58,31,.7),rgba(61,32,8,.9));border:1.5px solid var(--coop-mid);border-radius:var(--radius);padding:1.4rem;">
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:1rem;">
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">1ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Buy a Coop</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Purchase a starter Hen Coop facility. You must own a coop before placing hens.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">2ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Place Hens</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Place HenVerse NFTs into your coop grid. Each hen adds hashrate to your total. Unplaced hens earn nothing.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">3ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Earn EGG</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Your share of each block emission = your hashrate Ã· total network hashrate Ã— 2.5 EGG.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">4ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Claim Rewards</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Manually claim accrued EGG. Utility fee deducted on claim. Keep pending rewards above fee threshold.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">5ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Upgrade or Trade</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Upgrade your coop for more slots & power. Trade hens on the marketplace. Refer friends for 2.5% of their claims.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">â™»ï¸</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">The Flywheel</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">EGG earned â†’ buy more hens / upgrades â†’ more hashrate â†’ more EGG. Halvings create scarcity pressure driving token value.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- HOLDERS TAB -->
    <div id="tab-holders" class="tab-panel">
      <div class="holders-header">
        <div class="section-title" style="margin-bottom:0"><span>ğŸ‘¥</span> HenVerse Holders</div>
        <div style="display:flex;align-items:center;gap:.75rem;flex-wrap:wrap;">
          <span id="holders-count-badge" class="holders-count-badge" style="display:none">â€”</span>
          <button class="holders-load-btn" id="holders-load-btn" onclick="startHolderScan()">
            ğŸ” Scan All Holders
          </button>
          <button class="refresh-btn" id="holders-refresh-btn" onclick="startHolderScan()" style="display:none">
            â†» Re-scan
          </button>
        </div>
      </div>

      <div class="holders-meta" id="holders-meta" style="display:none">
        <div class="holders-meta-card">
          <div class="label">Unique Holders</div>
          <div class="value" id="meta-holders">â€”</div>
        </div>
        <div class="holders-meta-card">
          <div class="label">Total Minted</div>
          <div class="value" id="meta-minted">â€”</div>
        </div>
        <div class="holders-meta-card">
          <div class="label">Avg per Wallet</div>
          <div class="value" id="meta-avg">â€”</div>
        </div>
        <div class="holders-meta-card">
          <div class="label">Contract</div>
          <div class="value" style="font-size:.75rem;word-break:break-all;color:var(--straw)">0x42c3â€¦b7CF</div>
        </div>
      </div>

      <div class="holders-table-wrap" id="holders-table-wrap">
        <!-- Idle state -->
        <div id="holders-idle" style="text-align:center;padding:3rem 1.5rem;color:var(--straw);opacity:.65;">
          <div style="font-size:3rem;margin-bottom:.75rem">ğŸ”</div>
          <p style="font-size:.95rem">Click <strong style="color:var(--yolk)">Scan All Holders</strong> to enumerate every wallet<br/>holding a HenVerse NFT from The Grotto chain.</p>
          <p style="font-size:.78rem;margin-top:.75rem;font-family:var(--font-mono);opacity:.6">Scans Transfer events from block 0 â†’ latest Â· No API key needed</p>
        </div>

        <!-- Progress -->
        <div id="holders-progress" style="display:none" class="scan-progress">
          <div class="progress-label" id="progress-label">Scanning Transfer eventsâ€¦</div>
          <div class="progress-track">
            <div class="progress-fill" id="progress-fill" style="width:0%"></div>
          </div>
          <div class="scan-sub" id="progress-sub">Startingâ€¦</div>
        </div>

        <!-- Search bar (shown after load) -->
        <div class="holders-search" id="holders-search-bar" style="display:none">
          <span class="search-icon">ğŸ”</span>
          <input type="text" id="holders-search-input"
            placeholder="Search by address or token IDâ€¦"
            oninput="filterHolders(this.value)"/>
          <span id="holders-filter-count" style="font-family:var(--font-mono);font-size:.75rem;color:var(--straw);white-space:nowrap;"></span>
        </div>

        <!-- Table -->
        <div style="overflow-x:auto;" id="holders-table-container" style="display:none">
          <table class="holders-table" id="holders-table">
            <thead>
              <tr>
                <th onclick="sortHolders('rank')">#<span class="sort-arrow">â†•</span></th>
                <th onclick="sortHolders('address')">Wallet<span class="sort-arrow">â†•</span></th>
                <th onclick="sortHolders('count')" class="sorted">Hens<span class="sort-arrow">â†“</span></th>
                <th>Token IDs</th>
                <th>Explorer</th>
              </tr>
            </thead>
            <tbody id="holders-tbody"></tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="holders-pagination" style="display:none"></div>
      </div>
    </div>

    <!-- MARKET TAB -->
    <div id="tab-market" class="tab-panel">
      <div class="section-title"><span>ğŸ›’</span> Hen Market</div>
      <div class="market-notice">
        <div class="big">ğŸš§</div>
        <h3>Marketplace Coming Soon</h3>
        <p>Trade your HenVerse hens peer-to-peer.<br/>
        The marketplace will let you list, buy, and cancel NFT listings directly onchain.<br/><br/>
        In the meantime, you can mint your hens at the contract below and view them in your coop.</p>
        <br/>
        <a class="modal-link" href="https://explorer.avax.network/thegrotto/address/0x42c302FF8c34bb5D19bDA1a051bA89BD3a23b7CF" target="_blank" rel="noreferrer">View NFT Contract â†—</a>
      </div>

      <div class="section-title" style="margin-top:2rem"><span>ğŸ”</span> Hen Types</div>
      <div style="background:linear-gradient(160deg,rgba(107,58,31,.7),rgba(61,32,8,.9));border:1.5px solid var(--coop-mid);border-radius:var(--radius);padding:1.2rem;overflow-x:auto;">
        <table class="emission-table">
          <thead>
            <tr>
              <th>Hen Type</th>
              <th>Hashrate</th>
              <th>Power</th>
              <th>Cost (EGG)</th>
              <th>Supply</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>ğŸ£ Chick (Starter)</td><td class="highlight">10 MH/s</td><td>100W</td><td>500 EGG</td><td>2,000</td></tr>
            <tr><td>ğŸ” Standard Hen</td><td class="highlight">24 MH/s</td><td>200W</td><td>1,500 EGG</td><td>500</td></tr>
            <tr><td>ğŸ¦… Golden Hen</td><td class="highlight">70 MH/s</td><td>600W</td><td>4,000 EGG</td><td>30</td></tr>
            <tr><td>ğŸ¦š Legendary Rooster</td><td class="highlight">200 MH/s</td><td>1000W</td><td>5,000 EGG</td><td>20</td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </main>

  <!-- â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <footer>
    <span>HenVerse Â© 2025</span>
    <a href="https://explorer.avax.network/thegrotto" target="_blank" rel="noreferrer">Explorer â†—</a>
    <span>Chain ID: 36463</span>
    <span>NFT: 0x42c3â€¦b7CF</span>
  </footer>
</div>

<!-- â”€â”€â”€ NFT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="modal-overlay" onclick="closeModal(event)">
  <div class="modal" id="nft-modal">
    <div class="modal-header">
      <h3 id="modal-name">Hen #0</h3>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="modal-img-wrap"></div>
      <p class="modal-desc" id="modal-desc"></p>
      <div class="modal-attrs" id="modal-attrs"></div>
      <a class="modal-link" id="modal-explorer-link" href="#" target="_blank" rel="noreferrer">View on Explorer â†—</a>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CHAIN_ID     = 36463;
const CHAIN_HEX    = '0x' + CHAIN_ID.toString(16); // 0x8E6F
const RPC_URL      = 'https://subnets.avax.network/thegrotto/mainnet/rpc';
const EXPLORER     = 'https://explorer.avax.network/thegrotto';
const NFT_CONTRACT = '0x42c302FF8c34bb5D19bDA1a051bA89BD3a23b7CF';

// â”€â”€â”€ EMISSION CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BASE_EMISSION   = 2.5;      // EGG per block
const HALVING_INTERVAL = 4_200_000; // blocks
const MAX_SUPPLY      = 21_000_000;
const BLOCKS_PER_DAY  = 86400;    // ~1 block/sec on Grotto

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let walletAddr    = null;
let userNFTs      = [];
let placedNFTs    = new Set();
let isFetching    = false;

// â”€â”€â”€ FLOATERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function spawnFloaters() {
  const wrap   = document.getElementById('floaters');
  const icons  = ['ğŸ¥š','ğŸª¶','ğŸ“','ğŸ£','ğŸŒ¾','âœ¨'];
  for (let i = 0; i < 14; i++) {
    const el = document.createElement('div');
    el.className = 'floater';
    el.textContent = icons[i % icons.length];
    el.style.left     = Math.random() * 100 + 'vw';
    el.style.animationDuration = (14 + Math.random() * 18) + 's';
    el.style.animationDelay   = '-' + Math.random() * 25 + 's';
    el.style.fontSize = (.9 + Math.random() * .9) + 'rem';
    wrap.appendChild(el);
  }
})();

// â”€â”€â”€ TAB SWITCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(name) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  // match button by text pattern
  document.querySelectorAll('.nav-btn').forEach(b => {
    if (b.getAttribute('onclick').includes(name)) b.classList.add('active');
  });
}

// â”€â”€â”€ STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setStatus(msg, isError = false) {
  const bar = document.getElementById('status-bar');
  if (!msg) { bar.classList.remove('visible','error'); bar.textContent = ''; return; }
  bar.textContent = msg;
  bar.classList.toggle('error', isError);
  bar.classList.add('visible');
}

// â”€â”€â”€ RPC CALL (no external lib) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function rpcCall(method, params = []) {
  const res = await fetch(RPC_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ jsonrpc: '2.0', id: Date.now(), method, params }),
  });
  const json = await res.json();
  if (json.error) throw new Error(json.error.message || 'RPC error');
  return json.result;
}

// â”€â”€â”€ TINY ABI ENCODER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Known function selectors (keccak256 first 4 bytes)
const SEL = {
  'balanceOf(address)':             '70a08231',
  'tokenOfOwnerByIndex(address,uint256)': '2f745c59',
  'tokenURI(uint256)':              'c87b56dd',
  'totalSupply()':                  '18160ddd',
  'ownerOf(uint256)':               '6352211e',
  'name()':                         '06fdde03',
  'symbol()':                       '95d89b41',
};

function encodeFn(sig, ...args) {
  const sel = SEL[sig];
  if (!sel) throw new Error('Unknown selector: ' + sig);
  let data = sel;
  const types = (sig.match(/\(([^)]*)\)/)?.[1] || '').split(',').filter(Boolean);
  args.forEach((arg, i) => {
    const t = types[i]?.trim();
    if (t === 'address') {
      data += arg.toLowerCase().replace('0x','').padStart(64,'0');
    } else if (t === 'uint256') {
      data += BigInt(arg).toString(16).padStart(64,'0');
    }
  });
  return '0x' + data;
}

async function ethCall(sig, ...args) {
  const data = encodeFn(sig, ...args);
  return rpcCall('eth_call', [{ to: NFT_CONTRACT, data }, 'latest']);
}

// â”€â”€â”€ ABI DECODER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function decodeUint256(hex) {
  if (!hex || hex === '0x') return 0n;
  return BigInt(hex.slice(0,2) === '0x' ? hex : '0x' + hex);
}

function decodeString(hex) {
  try {
    if (!hex || hex === '0x') return '';
    const h = hex.startsWith('0x') ? hex.slice(2) : hex;
    if (h.length < 128) return '';
    // ABI string: slot0 = offset (usually 0x20 = 32), slot1 = length, then bytes
    const offset = Number(BigInt('0x' + h.slice(0,64))) * 2;
    const length = Number(BigInt('0x' + h.slice(offset, offset + 64)));
    if (length === 0) return '';
    const strHex = h.slice(offset + 64, offset + 64 + length * 2);
    let str = '';
    for (let i = 0; i < strHex.length; i += 2) {
      str += String.fromCharCode(parseInt(strHex.slice(i, i + 2), 16));
    }
    return str;
  } catch { return ''; }
}

// â”€â”€â”€ IPFS / URI helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resolveURI(uri) {
  if (!uri) return '';
  if (uri.startsWith('ipfs://')) return 'https://ipfs.io/ipfs/' + uri.slice(7);
  if (uri.startsWith('ipfs/'))   return 'https://ipfs.io/ipfs/' + uri.slice(5);
  return uri;
}

async function fetchMetadata(uri) {
  try {
    if (uri.startsWith('data:application/json;base64,')) {
      return JSON.parse(atob(uri.split(',')[1]));
    }
    if (uri.startsWith('data:application/json,')) {
      return JSON.parse(decodeURIComponent(uri.split(',')[1]));
    }
    const url = resolveURI(uri);
    if (!url) return null;
    const r = await fetch(url, { signal: AbortSignal.timeout(8000) });
    if (!r.ok) return null;
    return await r.json();
  } catch { return null; }
}

// â”€â”€â”€ CONNECT WALLET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function connectWallet() {
  if (!window.ethereum) {
    return setStatus('No wallet detected â€” please install MetaMask.', true);
  }
  setStatus('Connectingâ€¦');
  try {
    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    if (!accounts.length) { setStatus('No accounts found.', true); return; }
    walletAddr = accounts[0];

    // Ensure correct chain
    const currentChain = await window.ethereum.request({ method: 'eth_chainId' });
    if (parseInt(currentChain, 16) !== CHAIN_ID) {
      setStatus('Switching to The Grotto networkâ€¦');
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: CHAIN_HEX }],
        });
      } catch (switchErr) {
        if (switchErr.code === 4902) {
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: CHAIN_HEX,
              chainName: 'The Grotto',
              rpcUrls: [RPC_URL],
              blockExplorerUrls: [EXPLORER],
              nativeCurrency: { name: 'GRT', symbol: 'GRT', decimals: 18 },
            }],
          });
        } else {
          throw switchErr;
        }
      }
    }

    onWalletConnected(walletAddr);
  } catch (e) {
    setStatus(e.message || 'Failed to connect wallet.', true);
  }
}

function onWalletConnected(addr) {
  walletAddr = addr;
  // Update UI
  document.getElementById('connect-btn').style.display = 'none';
  const badge = document.getElementById('wallet-badge');
  badge.style.display = 'flex';
  document.getElementById('wallet-addr').textContent =
    addr.slice(0,6) + 'â€¦' + addr.slice(-4);
  document.getElementById('no-wallet-msg').style.display = 'none';
  document.getElementById('refresh-nfts-btn').style.display = 'block';
  document.getElementById('refresh-btn').style.display = 'inline-block';
  setStatus('');
  loadNFTs();
}

// Handle chain / account changes
if (window.ethereum) {
  window.ethereum.on('accountsChanged', (accs) => {
    if (accs.length) onWalletConnected(accs[0]);
    else window.location.reload();
  });
  window.ethereum.on('chainChanged', () => window.location.reload());
}

// â”€â”€â”€ LOAD NFTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Strategy: no ERC721Enumerable assumed.
// 1. balanceOf(wallet) â†’ how many tokens
// 2. eth_getLogs Transfer events TO this wallet â†’ collect token IDs received
// 3. eth_getLogs Transfer events FROM this wallet â†’ collect token IDs sent away
// 4. remaining = received - sent = currently owned
// 5. Confirm each with ownerOf (filter any stale ones)
// 6. Fetch tokenURI + metadata for confirmed IDs

const TRANSFER_TOPIC = '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef';

function padAddr(addr) {
  return '0x' + addr.toLowerCase().replace('0x','').padStart(64,'0');
}

async function getLogsAllChunks(filter) {
  const latestHex   = await rpcCall('eth_blockNumber', []);
  const latestBlock = parseInt(latestHex, 16);
  let allLogs = [];

  async function fetchRange(from, to) {
    if (from > to) return;
    try {
      const logs = await rpcCall('eth_getLogs', [{
        ...filter,
        fromBlock: '0x' + from.toString(16),
        toBlock:   '0x' + to.toString(16),
      }]);
      allLogs = allLogs.concat(logs);
    } catch (e) {
      const msg = (e.message || '').toLowerCase();
      if ((msg.includes('too large') || msg.includes('range') || msg.includes('limit') || msg.includes('exceed')) && to > from) {
        const mid = Math.floor((from + to) / 2);
        await fetchRange(from, mid);
        await fetchRange(mid + 1, to);
      } else {
        console.warn('getLogs failed (' + from + '-' + to + '):', e.message);
      }
    }
  }

  const CHUNK = 50000;
  for (let from = 0; from <= latestBlock; from += CHUNK) {
    const to = Math.min(from + CHUNK - 1, latestBlock);
    await fetchRange(from, to);
  }
  return allLogs;
}

function tokenIdFromLog(log) {
  // ERC-721 Transfer: topics = [sig, from, to] and tokenId in topics[3] OR data
  if (log.topics && log.topics[3]) {
    return Number(BigInt(log.topics[3]));
  }
  // Some contracts put tokenId in data
  if (log.data && log.data !== '0x' && log.data.length >= 66) {
    return Number(BigInt(log.data.slice(0, 66)));
  }
  return null;
}

async function loadNFTs() {
  if (!walletAddr || isFetching) return;
  isFetching = true;

  const refreshBtn  = document.getElementById('refresh-btn');
  const refreshBtn2 = document.getElementById('refresh-nfts-btn');
  refreshBtn.classList.add('spinning');
  const grid = document.getElementById('nft-grid');
  grid.innerHTML = '';
  for (let i = 0; i < 6; i++) {
    const sk = document.createElement('div'); sk.className = 'skeleton'; grid.appendChild(sk);
  }

  try {
    // â”€â”€ Step 1: Total supply (best-effort, non-blocking) â”€â”€
    let totalSupplyDisplay = '?';
    try {
      const tsHex = await ethCall('totalSupply()');
      totalSupplyDisplay = Number(decodeUint256(tsHex)).toLocaleString();
    } catch {}

    // â”€â”€ Step 2: Scan ALL Transfer logs for this contract â”€â”€
    // We get both directions at once and compute current ownership from event history.
    // This works for ANY ERC-721 regardless of whether it implements Enumerable.
    setStatus('Scanning Transfer events on The Grottoâ€¦ (first load may take ~15s)');

    const addrPadded = padAddr(walletAddr);

    // Fetch logs TO this address and FROM this address in parallel
    const [logsIn, logsOut] = await Promise.all([
      getLogsAllChunks({ address: NFT_CONTRACT, topics: [TRANSFER_TOPIC, null, addrPadded] }),
      getLogsAllChunks({ address: NFT_CONTRACT, topics: [TRANSFER_TOPIC, addrPadded, null] }),
    ]);

    // â”€â”€ Step 3: Build ownership map from log history â”€â”€
    // For each tokenId: track the block number of last transfer IN and last transfer OUT.
    // If last-in > last-out â†’ currently owned by this wallet.
    const received = new Map(); // tokenId â†’ highest blockNumber received
    for (const log of logsIn) {
      const id = tokenIdFromLog(log);
      if (id === null || id === undefined) continue;
      const bn = parseInt(log.blockNumber, 16);
      if (!received.has(id) || bn > received.get(id)) received.set(id, bn);
    }
    const sentOut = new Map(); // tokenId â†’ highest blockNumber sent
    // Also exclude mints FROM zero address being treated as "sent from wallet"
    const ZERO_PAD = '0x' + '0'.repeat(64);
    for (const log of logsOut) {
      // Skip if the "from" topic is zero address (these are mint events, not real transfers out)
      if (log.topics && log.topics[1] === ZERO_PAD) continue;
      const id = tokenIdFromLog(log);
      if (id === null || id === undefined) continue;
      const bn = parseInt(log.blockNumber, 16);
      if (!sentOut.has(id) || bn > sentOut.get(id)) sentOut.set(id, bn);
    }

    // Candidate IDs = tokens where last received block > last sent block
    let candidateIds = [];
    for (const [id, inBlock] of received) {
      const outBlock = sentOut.get(id) ?? -1;
      if (inBlock > outBlock) candidateIds.push(id);
    }
    candidateIds.sort((a, b) => a - b);

    // â”€â”€ Step 4: Confirm with ownerOf (catches edge cases like re-sold tokens) â”€â”€
    setStatus(`Verifying ownership of ${candidateIds.length} candidate token(s)â€¦`);
    const BATCH = 15;
    const confirmedIds = [];
    for (let i = 0; i < candidateIds.length; i += BATCH) {
      const batch = candidateIds.slice(i, i + BATCH);
      const results = await Promise.allSettled(batch.map(id =>
        rpcCall('eth_call', [{
          to: NFT_CONTRACT,
          data: '0x' + SEL['ownerOf(uint256)'] + BigInt(id).toString(16).padStart(64, '0')
        }, 'latest'])
      ));
      for (let j = 0; j < batch.length; j++) {
        const r = results[j];
        if (r.status === 'fulfilled' && r.value && r.value.length >= 42) {
          // ownerOf returns a padded address â€” last 40 hex chars
          const ownerRaw = '0x' + r.value.slice(-40);
          if (ownerRaw.toLowerCase() === walletAddr.toLowerCase()) {
            confirmedIds.push(batch[j]);
          }
        }
        // If ownerOf reverted or errored, trust the log-based result
        else if (r.status === 'rejected') {
          confirmedIds.push(batch[j]);
        }
      }
    }
    confirmedIds.sort((a, b) => a - b);

    // â”€â”€ Step 5: balanceOf for display (best-effort) â”€â”€
    let balanceDisplay = confirmedIds.length;
    try {
      const balHex = await ethCall('balanceOf(address)', walletAddr);
      balanceDisplay = Number(decodeUint256(balHex));
    } catch {}

    // Update UI counts
    document.getElementById('stat-hens').textContent = balanceDisplay;
    document.getElementById('nft-count-label').innerHTML =
      `You own <strong>${confirmedIds.length}</strong> hen${confirmedIds.length !== 1 ? 's' : ''}
       &nbsp;Â·&nbsp; <span style="opacity:.6">${totalSupplyDisplay} total minted</span>`;
    userNFTs = [];

    if (confirmedIds.length === 0) {
      grid.innerHTML = '';
      const empty = document.createElement('div');
      empty.className = 'empty-state';
      empty.innerHTML = `<div class="big">ğŸ£</div>
        <p>No HenVerse hens found in this wallet.<br/>
        <span style="font-size:.8rem;opacity:.6">Scanned ${logsIn.length} inbound transfer events</span></p>`;
      grid.appendChild(empty);
      document.getElementById('stat-hens').textContent = 0;
      setStatus('');
      updateCoopStats();
      return;
    }

    // â”€â”€ Step 6: Fetch tokenURI + metadata in parallel batches â”€â”€
    setStatus(`Fetching metadata for ${confirmedIds.length} hen(s)â€¦`);
    const CONCURRENCY = 6;
    const nfts = [];
    for (let i = 0; i < confirmedIds.length; i += CONCURRENCY) {
      const batch = confirmedIds.slice(i, i + CONCURRENCY);
      const results = await Promise.all(batch.map(async (id) => {
        let metadata = null;
        try {
          const uriHex = await ethCall('tokenURI(uint256)', id);
          const uri    = decodeString(uriHex);
          if (uri) metadata = await fetchMetadata(uri);
        } catch {}
        return { tokenId: id, metadata };
      }));
      nfts.push(...results);
    }
    userNFTs = nfts;

    // â”€â”€ Step 7: Render cards â”€â”€
    grid.innerHTML = '';
    nfts.forEach(nft => grid.appendChild(createNFTCard(nft)));
    document.getElementById('stat-hens').textContent = nfts.length;
    updateCoopStats();
    setStatus('');

  } catch (e) {
    grid.innerHTML = '';
    const errEl = document.createElement('div');
    errEl.className = 'empty-state';
    errEl.innerHTML = `<div class="big">âš ï¸</div>
      <p style="color:var(--shell)">Failed to load hens</p>
      <p style="font-size:.8rem;margin-top:.5rem;font-family:var(--font-mono);color:var(--red-warn)">${escHtml(e.message)}</p>
      <p style="font-size:.78rem;margin-top:.75rem;opacity:.6">Make sure you're connected to <strong>The Grotto</strong> network (Chain ID 36463)</p>`;
    grid.appendChild(errEl);
    setStatus('Error: ' + e.message, true);
  } finally {
    isFetching = false;
    refreshBtn.classList.remove('spinning');
  }
}

// â”€â”€â”€ CREATE NFT CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function createNFTCard(nft) {
  const { tokenId, metadata } = nft;
  const card = document.createElement('div');
  card.className = 'nft-card' + (placedNFTs.has(tokenId) ? ' selected' : '');
  card.onclick = () => openModal(nft);

  const name  = metadata?.name  || `Hen #${tokenId}`;
  const image = resolveURI(metadata?.image || metadata?.image_url || '');

  let imgHtml;
  if (image) {
    imgHtml = `<img src="${escAttr(image)}" alt="${escAttr(name)}"
      onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"/>
      <div class="nft-img-placeholder" style="display:none;aspect-ratio:1">ğŸ”</div>`;
  } else {
    imgHtml = `<div class="nft-img-placeholder">ğŸ”</div>`;
  }

  const badge = placedNFTs.has(tokenId)
    ? '<div class="nft-badge placed">In Coop</div>'
    : '<div class="nft-badge">Wallet</div>';

  card.innerHTML = `
    ${badge}
    ${imgHtml}
    <div class="nft-info">
      <div class="nft-name">${escHtml(name)}</div>
      <div class="nft-id">#${tokenId}</div>
    </div>
  `;
  return card;
}

// â”€â”€â”€ OPEN NFT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(nft) {
  const { tokenId, metadata } = nft;
  const name  = metadata?.name  || `Hen #${tokenId}`;
  const image = resolveURI(metadata?.image || metadata?.image_url || '');
  const desc  = metadata?.description || '';
  const attrs = metadata?.attributes || metadata?.traits || [];

  document.getElementById('modal-name').textContent = name;

  // Image
  const imgWrap = document.getElementById('modal-img-wrap');
  if (image) {
    imgWrap.innerHTML = `<img class="modal-img" src="${escAttr(image)}" alt="${escAttr(name)}"
      onerror="this.outerHTML='<div class=\\'modal-img-placeholder\\'>ğŸ”</div>'"/>`;
  } else {
    imgWrap.innerHTML = `<div class="modal-img-placeholder">ğŸ”</div>`;
  }

  // Description
  document.getElementById('modal-desc').textContent = desc;

  // Attributes
  const attrsEl = document.getElementById('modal-attrs');
  if (Array.isArray(attrs) && attrs.length) {
    attrsEl.innerHTML = attrs.slice(0,8).map(a => `
      <div class="attr-pill">
        <div class="attr-type">${escHtml(String(a.trait_type || a.name || ''))}</div>
        <div class="attr-val">${escHtml(String(a.value || ''))}</div>
      </div>
    `).join('');
  } else {
    attrsEl.innerHTML = '';
  }

  // Explorer link
  document.getElementById('modal-explorer-link').href =
    `${EXPLORER}/token/${NFT_CONTRACT}?tokenId=${tokenId}`;

  document.getElementById('modal-overlay').classList.add('open');
}

function closeModal(e) {
  if (e && e.target !== document.getElementById('modal-overlay')) return;
  document.getElementById('modal-overlay').classList.remove('open');
}

// â”€â”€â”€ COOP STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Approximate hen stats â€” will be driven by contract later
const HEN_STATS = {
  default: { hashrate: 10, power: 100 }  // MH/s, W per hen NFT
};

function updateCoopStats() {
  const placed = placedNFTs.size;
  const hashrate = placed * HEN_STATS.default.hashrate;
  const power    = placed * HEN_STATS.default.power;
  const capacity = 2000; // W starter coop

  document.getElementById('stat-placed').textContent   = placed;
  document.getElementById('stat-hashrate').textContent = hashrate + ' MH/s';
  document.getElementById('stat-power').textContent    = power + 'W';
  document.getElementById('power-label-val').textContent = power + ' / ' + capacity + 'W';

  const pct = Math.min(100, (power / capacity) * 100);
  const bar = document.getElementById('power-bar');
  bar.style.width = pct + '%';
  bar.className = 'power-bar-fill' +
    (pct > 85 ? ' danger' : pct > 60 ? ' warn' : '');
}

// â”€â”€â”€ EMISSION SCHEDULE TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function buildEmissionTable() {
  const tbody = document.getElementById('emission-tbody');
  let cumulative = 0;
  let rate = BASE_EMISSION;
  let rows = '';

  for (let era = 1; era <= 8; era++) {
    if (cumulative >= MAX_SUPPLY) break;
    const eraSupply = Math.min(rate * HALVING_INTERVAL, MAX_SUPPLY - cumulative);
    cumulative += eraSupply;
    const days = Math.round((HALVING_INTERVAL / BLOCKS_PER_DAY));

    // Estimate if this is the current era (just mark era 1 as current for now)
    const isCurrentEra = era === 1;
    rows += `<tr class="${isCurrentEra ? 'current-era' : ''}">
      <td>${isCurrentEra ? 'âš¡ ' : ''}Era ${era}</td>
      <td class="highlight">${(HALVING_INTERVAL * (era-1)).toLocaleString()} â€“ ${(HALVING_INTERVAL * era).toLocaleString()}</td>
      <td>${rate.toFixed(4)} EGG/block</td>
      <td>${eraSupply.toLocaleString(undefined, {maximumFractionDigits:0})} EGG</td>
      <td>${cumulative.toLocaleString(undefined, {maximumFractionDigits:0})} EGG</td>
      <td>~${days}d</td>
    </tr>`;
    rate /= 2;
  }
  tbody.innerHTML = rows;
})();

// â”€â”€â”€ HOLDERS SCANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Strategy:
//   1. Get totalSupply â†’ that's how many token IDs exist (1-based or 0-based)
//   2. Fetch ownerOf for each tokenId in parallel batches
//   3. Group by owner â†’ build leaderboard
//   Fallback: also try eth_getLogs for Transfer events to find all ever-minted IDs

let holderData     = [];   // [{address, tokens:[]}]
let holderFiltered = [];
let holderSort     = { key: 'count', dir: -1 };
let holderPage     = 0;
const HOLDER_PER_PAGE = 25;
let scanRunning    = false;

async function startHolderScan() {
  if (scanRunning) return;
  scanRunning = true;

  // UI reset
  document.getElementById('holders-idle').style.display       = 'none';
  document.getElementById('holders-progress').style.display   = 'block';
  document.getElementById('holders-search-bar').style.display = 'none';
  document.getElementById('holders-table-container').style.display = 'none';
  document.getElementById('holders-pagination').style.display = 'none';
  document.getElementById('holders-meta').style.display       = 'none';
  document.getElementById('holders-load-btn').style.display   = 'none';
  document.getElementById('holders-refresh-btn').style.display = 'none';
  document.getElementById('holders-count-badge').style.display = 'none';
  setStatus('Scanning HenVerse holders on The Grottoâ€¦');

  try {
    // â”€â”€ Step 1: Get latest block + total supply â”€â”€
    setProgress('Connecting to The Grottoâ€¦', 2);
    const [latestHex, tsHex] = await Promise.all([
      rpcCall('eth_blockNumber', []),
      ethCall('totalSupply()').catch(() => '0x0'),
    ]);
    const latestBlock = parseInt(latestHex, 16);
    const totalMinted = Number(decodeUint256(tsHex));
    document.getElementById('meta-minted').textContent = totalMinted.toLocaleString();

    // â”€â”€ Step 2: Scan ALL Transfer events in chunks â”€â”€
    // Build a map: tokenId â†’ {owner, blockNumber} using latest transfer
    const CHUNK = 100000;
    const totalChunks = Math.ceil(latestBlock / CHUNK);
    // tokenState[id] = { owner (lowercased), block }
    const tokenState = {};  // tracks latest known owner per token

    let chunkIdx = 0;
    for (let from = 0; from <= latestBlock; from += CHUNK) {
      const to = Math.min(from + CHUNK - 1, latestBlock);
      const pct = 5 + Math.round((chunkIdx / Math.max(totalChunks, 1)) * 80);
      setProgress(
        `Scanning blocks ${from.toLocaleString()} â†’ ${to.toLocaleString()}â€¦`,
        pct
      );
      document.getElementById('progress-sub').textContent =
        `Chunk ${chunkIdx + 1} / ${totalChunks} Â· ${Object.keys(tokenState).length} tokens found`;

      let logs = [];
      try {
        logs = await rpcCall('eth_getLogs', [{
          address: NFT_CONTRACT,
          topics:  [TRANSFER_TOPIC],
          fromBlock: '0x' + from.toString(16),
          toBlock:   '0x' + to.toString(16),
        }]);
      } catch (e) {
        console.warn('getLogs chunk failed:', e.message);
        // try halving the chunk
        try {
          const mid = Math.floor((from + to) / 2);
          const [a, b] = await Promise.all([
            rpcCall('eth_getLogs', [{ address: NFT_CONTRACT, topics: [TRANSFER_TOPIC], fromBlock: '0x' + from.toString(16), toBlock: '0x' + mid.toString(16) }]),
            rpcCall('eth_getLogs', [{ address: NFT_CONTRACT, topics: [TRANSFER_TOPIC], fromBlock: '0x' + (mid+1).toString(16), toBlock: '0x' + to.toString(16) }]),
          ]);
          logs = [...a, ...b];
        } catch { /* skip chunk */ }
      }

      // Process logs in block order
      for (const log of logs) {
        const id = tokenIdFromLog(log);
        if (id === null || isNaN(id)) continue;
        const blockNum = parseInt(log.blockNumber, 16);
        const toAddr   = ('0x' + (log.topics[2] || '').slice(-40)).toLowerCase();
        const ZERO     = '0x0000000000000000000000000000000000000000';

        // Only update if this event is newer than what we have
        if (!tokenState[id] || blockNum >= tokenState[id].block) {
          tokenState[id] = {
            owner: toAddr === ZERO ? null : toAddr,  // null = burned
            block: blockNum,
          };
        }
      }
      chunkIdx++;
    }

    // â”€â”€ Step 3: Build owner map from tokenState â”€â”€
    setProgress('Building holder leaderboardâ€¦', 88);
    document.getElementById('progress-sub').textContent = `Processing ${Object.keys(tokenState).length} token statesâ€¦`;

    const ownerMap = {};
    for (const [idStr, state] of Object.entries(tokenState)) {
      if (!state.owner) continue; // burned
      const owner = state.owner;
      if (!ownerMap[owner]) ownerMap[owner] = [];
      ownerMap[owner].push(Number(idStr));
    }

    // â”€â”€ Step 4: Verify ambiguous cases with ownerOf â”€â”€
    // Skip full verification to keep it fast; Transfer logs are reliable
    setProgress('Finalisingâ€¦', 96);

    if (Object.keys(ownerMap).length === 0) {
      showHolderEmpty('No holders found. The collection may have no mints yet.');
      return;
    }

    holderData = Object.entries(ownerMap)
      .map(([address, tokens]) => ({
        address,
        tokens: tokens.sort((a, b) => a - b),
        count:  tokens.length,
      }))
      .sort((a, b) => b.count - a.count);

    holderFiltered = [...holderData];

    setProgress('Done!', 100);
    await sleep(350);
    renderHolders();
    setStatus('');

  } catch (e) {
    setStatus('Holder scan failed: ' + e.message, true);
    document.getElementById('holders-progress').style.display = 'none';
    document.getElementById('holders-idle').style.display     = 'block';
    document.getElementById('holders-idle').innerHTML =
      `<div style="font-size:2.5rem;margin-bottom:.5rem">âš ï¸</div>
       <p>Scan failed: ${escHtml(e.message)}</p>`;
    document.getElementById('holders-load-btn').style.display = 'inline-block';
  } finally {
    scanRunning = false;
  }
}

function setProgress(label, pct) {
  document.getElementById('progress-label').textContent = label;
  document.getElementById('progress-fill').style.width  = Math.min(100, pct) + '%';
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

function renderHolders() {
  const total      = holderData.reduce((s,h) => s + h.count, 0);
  const uniq       = holderData.length;
  const avg        = uniq ? (total / uniq).toFixed(2) : '0';

  document.getElementById('meta-holders').textContent = uniq.toLocaleString();
  document.getElementById('meta-minted').textContent  = total.toLocaleString();
  document.getElementById('meta-avg').textContent     = avg;
  document.getElementById('holders-meta').style.display = 'flex';

  document.getElementById('holders-count-badge').textContent = uniq + ' holders';
  document.getElementById('holders-count-badge').style.display = 'inline-flex';

  document.getElementById('holders-progress').style.display   = 'none';
  document.getElementById('holders-search-bar').style.display = 'flex';
  document.getElementById('holders-table-container').style.display = 'block';
  document.getElementById('holders-load-btn').style.display   = 'none';
  document.getElementById('holders-refresh-btn').style.display = 'inline-block';

  holderPage = 0;
  renderHoldersPage();
}

function renderHoldersPage() {
  const tbody = document.getElementById('holders-tbody');
  const total = holderFiltered.length;
  const start = holderPage * HOLDER_PER_PAGE;
  const slice = holderFiltered.slice(start, start + HOLDER_PER_PAGE);

  tbody.innerHTML = '';
  if (slice.length === 0) {
    tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;padding:2rem;color:var(--straw);opacity:.6">No results found</td></tr>`;
  } else {
    slice.forEach((h, idx) => {
      const globalRank = holderData.indexOf(h) + 1;
      const isYou = walletAddr && h.address.toLowerCase() === walletAddr.toLowerCase();
      const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
      const rankDisplay = globalRank <= 3
        ? `<span class="rank-num top3">${medals[globalRank-1]}</span>`
        : `<span class="rank-num">${globalRank}</span>`;

      const shortAddr = h.address.slice(0,6) + 'â€¦' + h.address.slice(-4);
      const avatarEmoji = addressEmoji(h.address);

      // Show up to 6 token chips
      const chipHtml = h.tokens.slice(0,6).map(id =>
        `<span class="token-chip" onclick="openTokenModal(${id})">#${id}</span>`
      ).join('') + (h.tokens.length > 6 ? `<span class="token-chip" style="opacity:.5">+${h.tokens.length-6}</span>` : '');

      const tr = document.createElement('tr');
      if (isYou) tr.className = 'is-connected';
      tr.innerHTML = `
        <td>${rankDisplay}</td>
        <td>
          <div class="addr-cell">
            <div class="addr-avatar">${avatarEmoji}</div>
            <div class="addr-text">
              <div class="addr-full">${h.address}${isYou ? ' <span class="you-tag">YOU</span>' : ''}</div>
              <div class="addr-short">${shortAddr}${isYou ? ' <span class="you-tag">YOU</span>' : ''}</div>
            </div>
            <button class="copy-btn" title="Copy address" onclick="copyAddr('${h.address}')">â˜</button>
          </div>
        </td>
        <td><strong style="color:var(--yolk)">${h.count}</strong></td>
        <td><div class="token-chips">${chipHtml}</div><span style="font-size:.72rem;color:var(--straw);display:none" class="token-count-mobile">${h.count} tokens</span></td>
        <td>
          <a href="${EXPLORER}/address/${h.address}" target="_blank" rel="noreferrer"
            style="color:var(--yolk);font-family:var(--font-mono);font-size:.75rem;text-decoration:none;border:1px solid rgba(245,166,35,.3);padding:.2rem .55rem;border-radius:5px;white-space:nowrap;"
            onmouseover="this.style.background='rgba(245,166,35,.12)'" onmouseout="this.style.background='none'">
            View â†—
          </a>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  renderPagination(total);
  document.getElementById('holders-filter-count').textContent =
    holderFiltered.length !== holderData.length
      ? `${holderFiltered.length} of ${holderData.length}`
      : `${holderData.length} holders`;
}

function renderPagination(total) {
  const totalPages = Math.ceil(total / HOLDER_PER_PAGE);
  const pag = document.getElementById('holders-pagination');
  if (totalPages <= 1) { pag.style.display = 'none'; return; }
  pag.style.display = 'flex';

  let html = `<button class="page-btn" onclick="goPage(${holderPage-1})" ${holderPage===0?'disabled':''}>â† Prev</button>`;

  const range = pagRange(holderPage, totalPages);
  let prev = null;
  for (const p of range) {
    if (prev !== null && p > prev + 1) html += `<span style="color:var(--straw);padding:0 .25rem">â€¦</span>`;
    html += `<button class="page-btn ${p===holderPage?'active':''}" onclick="goPage(${p})">${p+1}</button>`;
    prev = p;
  }
  html += `<button class="page-btn" onclick="goPage(${holderPage+1})" ${holderPage>=totalPages-1?'disabled':''}>Next â†’</button>`;
  pag.innerHTML = html;
}

function pagRange(current, total) {
  const delta = 2;
  const pages = new Set([0, total-1]);
  for (let i = Math.max(0,current-delta); i <= Math.min(total-1,current+delta); i++) pages.add(i);
  return [...pages].sort((a,b)=>a-b);
}

function goPage(p) {
  const totalPages = Math.ceil(holderFiltered.length / HOLDER_PER_PAGE);
  if (p < 0 || p >= totalPages) return;
  holderPage = p;
  renderHoldersPage();
  document.getElementById('holders-table-wrap').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function filterHolders(q) {
  const query = q.trim().toLowerCase();
  if (!query) {
    holderFiltered = [...holderData];
  } else {
    holderFiltered = holderData.filter(h =>
      h.address.toLowerCase().includes(query) ||
      h.tokens.some(id => String(id).includes(query))
    );
  }
  holderPage = 0;
  renderHoldersPage();
}

function sortHolders(key) {
  if (holderSort.key === key) {
    holderSort.dir *= -1;
  } else {
    holderSort.key = key;
    holderSort.dir = key === 'count' ? -1 : 1;
  }
  holderFiltered.sort((a,b) => {
    if (key === 'count')   return holderSort.dir * (a.count - b.count);
    if (key === 'address') return holderSort.dir * a.address.localeCompare(b.address);
    return 0;
  });
  holderPage = 0;
  renderHoldersPage();
  // Update header arrows
  document.querySelectorAll('.holders-table th').forEach(th => th.classList.remove('sorted'));
  event.currentTarget.classList.add('sorted');
}

function copyAddr(addr) {
  navigator.clipboard.writeText(addr).then(() => {
    setStatus('Address copied: ' + addr);
    setTimeout(() => setStatus(''), 2000);
  });
}

// Deterministic emoji avatar from address
function addressEmoji(addr) {
  const emojis = ['ğŸ”','ğŸ£','ğŸ¥š','ğŸ¦š','ğŸ¦…','ğŸŒ¾','ğŸ“','ğŸŒ»','ğŸªº','ğŸŒ¿'];
  const n = parseInt(addr.slice(2,8), 16);
  return emojis[n % emojis.length];
}

function showHolderEmpty(msg) {
  document.getElementById('holders-progress').style.display = 'none';
  document.getElementById('holders-idle').style.display = 'block';
  document.getElementById('holders-idle').innerHTML = `<div style="font-size:2.5rem;margin-bottom:.5rem">ğŸ£</div><p>${escHtml(msg)}</p>`;
  document.getElementById('holders-load-btn').style.display = 'inline-block';
}

// Open a token in modal from holders tab (fetch metadata)
async function openTokenModal(tokenId) {
  // Try to find in loaded NFTs first
  const cached = userNFTs.find(n => n.tokenId === tokenId);
  if (cached) { openModal(cached); return; }
  // Otherwise fetch on-demand
  try {
    const uriHex  = await ethCall('tokenURI(uint256)', tokenId);
    const uri     = decodeString(uriHex);
    const metadata = await fetchMetadata(uri);
    openModal({ tokenId, metadata });
  } catch {
    openModal({ tokenId, metadata: null });
  }
}



function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function escAttr(s) {
  return String(s).replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}
</script>
</body>
</html>
