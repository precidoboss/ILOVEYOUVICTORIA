<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>HenVerse â€” Egg Mining on The Grotto</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,700;0,9..144,900;1,9..144,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
/* â”€â”€â”€ DESIGN TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --yolk:       #F5A623;
  --yolk-deep:  #C8781A;
  --shell:      #FFF8E8;
  --coop-brown: #3D2008;
  --coop-mid:   #6B3A1F;
  --coop-light: #A0622A;
  --straw:      #E8C97A;
  --straw-pale: #F5EAC5;
  --green:      #5B8C3E;
  --green-pale: #C5DFB3;
  --red-warn:   #C0392B;
  --sky:        #D0EAF8;
  --ink:        #1A0D00;
  --ink-mid:    #4A2E10;
  --shadow:     rgba(61,32,8,.18);
  --glow:       rgba(245,166,35,.35);
  --radius:     14px;
  --radius-sm:  8px;
  --font-display: 'Fraunces', Georgia, serif;
  --font-mono:    'DM Mono', monospace;
}

/* â”€â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: var(--font-display);
  background: var(--coop-brown);
  color: var(--shell);
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

/* â”€â”€â”€ BACKGROUND TEXTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background:
    radial-gradient(ellipse 80% 60% at 50% -10%, #6B3A1F 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 100% 100%, #A0622A22 0%, transparent 60%),
    repeating-linear-gradient(
      45deg,
      transparent,
      transparent 18px,
      rgba(160,98,42,.07) 18px,
      rgba(160,98,42,.07) 19px
    );
  pointer-events: none;
}

/* Grain overlay */
body::after {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events: none;
  opacity: .5;
}

/* â”€â”€â”€ FLOATING BITS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.floaters { position: fixed; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
.floater {
  position: absolute;
  font-size: 1.4rem;
  opacity: .18;
  animation: drift linear infinite;
}
@keyframes drift {
  0%   { transform: translateY(110vh) rotate(0deg);   opacity: .0; }
  10%  { opacity: .18; }
  90%  { opacity: .18; }
  100% { transform: translateY(-10vh)  rotate(360deg); opacity: .0; }
}

/* â”€â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app { position: relative; z-index: 2; min-height: 100vh; display: flex; flex-direction: column; }

/* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header {
  display: flex; align-items: center; gap: 1.5rem;
  padding: 1.1rem 2rem;
  background: rgba(61,32,8,.78);
  backdrop-filter: blur(14px);
  border-bottom: 2px solid var(--coop-light);
  position: sticky; top: 0; z-index: 100;
  flex-wrap: wrap;
}
.logo {
  display: flex; align-items: center; gap: .75rem;
  flex-shrink: 0;
}
.logo-egg {
  font-size: 2.2rem;
  filter: drop-shadow(0 0 12px var(--yolk));
  animation: pulse-egg 3s ease-in-out infinite;
}
@keyframes pulse-egg {
  0%,100% { filter: drop-shadow(0 0 10px var(--yolk)); transform: scale(1); }
  50%      { filter: drop-shadow(0 0 22px var(--yolk)); transform: scale(1.07); }
}
.logo-text h1 {
  font-family: var(--font-display);
  font-weight: 900;
  font-size: 1.55rem;
  color: var(--yolk);
  letter-spacing: -.02em;
  line-height: 1;
}
.logo-text p {
  font-size: .72rem;
  font-family: var(--font-mono);
  color: var(--straw);
  letter-spacing: .08em;
  opacity: .8;
}

nav { display: flex; gap: .5rem; flex: 1; justify-content: center; flex-wrap: wrap; }
.nav-btn {
  background: none;
  border: 1.5px solid transparent;
  color: var(--straw-pale);
  font-family: var(--font-display);
  font-weight: 700;
  font-size: .9rem;
  padding: .45rem 1.1rem;
  border-radius: 999px;
  cursor: pointer;
  transition: all .2s;
  letter-spacing: .01em;
}
.nav-btn:hover { border-color: var(--straw); color: var(--shell); }
.nav-btn.active {
  background: var(--yolk);
  border-color: var(--yolk);
  color: var(--coop-brown);
}

.wallet-zone { display: flex; align-items: center; gap: .75rem; flex-shrink: 0; }
#connect-btn {
  background: linear-gradient(135deg, var(--yolk), var(--yolk-deep));
  border: none;
  color: var(--coop-brown);
  font-family: var(--font-display);
  font-weight: 700;
  font-size: .9rem;
  padding: .5rem 1.4rem;
  border-radius: 999px;
  cursor: pointer;
  box-shadow: 0 3px 14px var(--glow);
  transition: transform .15s, box-shadow .15s;
}
#connect-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px var(--glow); }
#connect-btn:active { transform: translateY(0); }
#wallet-badge {
  display: none;
  align-items: center; gap: .5rem;
  background: rgba(245,166,35,.15);
  border: 1.5px solid var(--yolk);
  border-radius: 999px;
  padding: .35rem .9rem;
  font-family: var(--font-mono);
  font-size: .82rem;
  color: var(--yolk);
}
#wallet-badge .dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: #4CAF50;
  box-shadow: 0 0 6px #4CAF50;
  flex-shrink: 0;
}

/* â”€â”€â”€ STATUS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#status-bar {
  display: none;
  background: rgba(200,120,26,.25);
  border-bottom: 1px solid var(--yolk-deep);
  padding: .55rem 2rem;
  font-family: var(--font-mono);
  font-size: .82rem;
  color: var(--straw);
  text-align: center;
  z-index: 99;
}
#status-bar.error { background: rgba(192,57,43,.25); border-color: var(--red-warn); color: #f8a5a0; }
#status-bar.visible { display: block; }

/* â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
main { flex: 1; padding: 2rem; max-width: 1300px; margin: 0 auto; width: 100%; }

/* Tabs */
.tab-panel { display: none; animation: fadeIn .3s ease; }
.tab-panel.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }

/* â”€â”€â”€ SECTION TITLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-title {
  font-size: 1.6rem;
  font-weight: 900;
  color: var(--yolk);
  margin-bottom: 1.5rem;
  display: flex; align-items: center; gap: .6rem;
}
.section-title span { font-size: 1.8rem; }

/* â”€â”€â”€ COOP TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#tab-coop { display: grid; grid-template-columns: 320px 1fr; gap: 2rem; align-items: start; }
@media(max-width:900px) { #tab-coop { grid-template-columns: 1fr; } }

/* Facility Card */
.facility-card {
  background: linear-gradient(160deg, rgba(107,58,31,.85), rgba(61,32,8,.95));
  border: 2px solid var(--coop-light);
  border-radius: var(--radius);
  padding: 1.5rem;
  box-shadow: 0 8px 32px var(--shadow);
  position: sticky; top: 90px;
}
.facility-card h2 { font-size: 1.2rem; font-weight: 900; color: var(--yolk); margin-bottom: 1rem; }
.facility-art {
  width: 100%;
  aspect-ratio: 4/3;
  background: linear-gradient(180deg, var(--sky) 0%, var(--green-pale) 60%, var(--green) 100%);
  border-radius: var(--radius-sm);
  overflow: hidden;
  position: relative;
  margin-bottom: 1rem;
  border: 2px solid var(--coop-light);
}
/* SVG coop illustration */
.facility-art svg { width: 100%; height: 100%; }

.stats-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: .6rem; margin-bottom: 1rem;
}
.stat-box {
  background: rgba(245,166,35,.1);
  border: 1px solid rgba(245,166,35,.2);
  border-radius: var(--radius-sm);
  padding: .65rem .9rem;
}
.stat-box .label {
  font-family: var(--font-mono);
  font-size: .68rem;
  letter-spacing: .06em;
  color: var(--straw);
  margin-bottom: .2rem;
  text-transform: uppercase;
}
.stat-box .value { font-size: 1.05rem; font-weight: 900; color: var(--yolk); }

.coop-btn {
  width: 100%;
  background: linear-gradient(135deg, var(--yolk), var(--yolk-deep));
  border: none;
  color: var(--coop-brown);
  font-family: var(--font-display);
  font-weight: 900;
  font-size: 1rem;
  padding: .75rem;
  border-radius: var(--radius-sm);
  cursor: pointer;
  box-shadow: 0 4px 18px var(--glow);
  transition: transform .15s, box-shadow .15s;
  margin-top: .4rem;
}
.coop-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px var(--glow); }
.coop-btn:disabled {
  opacity: .5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}
.coop-btn.secondary {
  background: transparent;
  border: 2px solid var(--coop-light);
  color: var(--straw);
  box-shadow: none;
  margin-top: .5rem;
}
.coop-btn.secondary:hover { border-color: var(--yolk); color: var(--yolk); background: rgba(245,166,35,.08); }

/* NFT Grid */
.nft-section { }
.nft-controls {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 1.2rem; gap: 1rem; flex-wrap: wrap;
}
.nft-count {
  font-family: var(--font-mono);
  font-size: .82rem;
  color: var(--straw);
}
.nft-count strong { color: var(--yolk); font-size: 1.1rem; }

.refresh-btn {
  background: transparent;
  border: 1.5px solid var(--coop-light);
  color: var(--straw);
  font-family: var(--font-mono);
  font-size: .78rem;
  padding: .35rem .85rem;
  border-radius: 999px;
  cursor: pointer;
  transition: all .2s;
  letter-spacing: .04em;
}
.refresh-btn:hover { border-color: var(--yolk); color: var(--yolk); }
.refresh-btn.spinning { animation: spin .8s linear infinite; pointer-events: none; }
@keyframes spin { to { transform: rotate(360deg); } }

/* NFT Grid */
.nft-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
  gap: 1rem;
}
.nft-card {
  background: linear-gradient(160deg, rgba(107,58,31,.7), rgba(61,32,8,.9));
  border: 1.5px solid var(--coop-mid);
  border-radius: var(--radius);
  overflow: hidden;
  cursor: pointer;
  transition: transform .2s, border-color .2s, box-shadow .2s;
  position: relative;
}
.nft-card:hover {
  transform: translateY(-4px);
  border-color: var(--yolk);
  box-shadow: 0 8px 28px var(--glow);
}
.nft-card.selected {
  border-color: var(--yolk);
  box-shadow: 0 0 0 3px rgba(245,166,35,.4), 0 8px 28px var(--glow);
}
.nft-card img {
  width: 100%; aspect-ratio: 1;
  object-fit: cover;
  display: block;
  background: var(--coop-brown);
}
.nft-card .nft-img-placeholder {
  width: 100%; aspect-ratio: 1;
  display: flex; align-items: center; justify-content: center;
  font-size: 3rem;
  background: linear-gradient(135deg, #4A2E10, #3D2008);
  color: var(--yolk);
}
.nft-card .nft-info {
  padding: .65rem .8rem;
}
.nft-card .nft-name {
  font-weight: 700;
  font-size: .88rem;
  color: var(--shell);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.nft-card .nft-id {
  font-family: var(--font-mono);
  font-size: .72rem;
  color: var(--straw);
  opacity: .7;
  margin-top: .15rem;
}
.nft-card .nft-badge {
  position: absolute;
  top: .5rem; right: .5rem;
  background: var(--green);
  color: #fff;
  font-family: var(--font-mono);
  font-size: .65rem;
  padding: .15rem .45rem;
  border-radius: 999px;
  font-weight: 500;
}
.nft-card .nft-badge.placed { background: var(--yolk-deep); }

/* Empty / Loading states */
.empty-state {
  grid-column: 1/-1;
  text-align: center;
  padding: 3rem 1rem;
  color: var(--straw);
  opacity: .6;
}
.empty-state .big { font-size: 3.5rem; margin-bottom: .75rem; }
.empty-state p { font-size: .95rem; }

.skeleton {
  background: linear-gradient(90deg, rgba(107,58,31,.5) 25%, rgba(160,98,42,.5) 50%, rgba(107,58,31,.5) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.4s infinite;
  border-radius: var(--radius);
  aspect-ratio: 1;
}
@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

/* â”€â”€â”€ POWER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.power-bar-wrap {
  margin: 1rem 0;
}
.power-bar-label {
  display: flex; justify-content: space-between;
  font-family: var(--font-mono); font-size: .73rem;
  color: var(--straw); margin-bottom: .35rem;
}
.power-bar-track {
  height: 10px;
  background: rgba(255,255,255,.1);
  border-radius: 999px;
  overflow: hidden;
}
.power-bar-fill {
  height: 100%;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--green), var(--yolk));
  transition: width .5s ease;
}
.power-bar-fill.warn { background: linear-gradient(90deg, var(--yolk), #e67e22); }
.power-bar-fill.danger { background: linear-gradient(90deg, #e67e22, var(--red-warn)); }

/* â”€â”€â”€ TOKENOMICS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toko-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 1.2rem;
  margin-bottom: 2rem;
}
.toko-card {
  background: linear-gradient(160deg, rgba(107,58,31,.7), rgba(61,32,8,.9));
  border: 1.5px solid var(--coop-mid);
  border-radius: var(--radius);
  padding: 1.4rem;
}
.toko-card h3 {
  font-size: .78rem;
  font-family: var(--font-mono);
  letter-spacing: .08em;
  text-transform: uppercase;
  color: var(--straw);
  margin-bottom: .6rem;
}
.toko-card .big-num {
  font-size: 1.9rem;
  font-weight: 900;
  color: var(--yolk);
  line-height: 1;
}
.toko-card .sub-num { font-size: .82rem; color: var(--straw); margin-top: .3rem; }

.emission-table {
  width: 100%;
  border-collapse: collapse;
  font-family: var(--font-mono);
  font-size: .82rem;
  margin-top: .5rem;
}
.emission-table th {
  text-align: left;
  color: var(--straw);
  padding: .5rem .75rem;
  border-bottom: 1px solid rgba(160,98,42,.4);
  font-size: .72rem;
  letter-spacing: .06em;
  text-transform: uppercase;
}
.emission-table td {
  padding: .55rem .75rem;
  border-bottom: 1px solid rgba(160,98,42,.15);
  color: var(--shell);
}
.emission-table tr:last-child td { border-bottom: none; }
.emission-table .highlight { color: var(--yolk); font-weight: 700; }
.emission-table tr.current-era { background: rgba(245,166,35,.08); }

/* â”€â”€â”€ MARKET TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.market-notice {
  background: linear-gradient(160deg, rgba(107,58,31,.7), rgba(61,32,8,.9));
  border: 1.5px solid var(--coop-mid);
  border-radius: var(--radius);
  padding: 2rem;
  text-align: center;
  color: var(--straw);
}
.market-notice .big { font-size: 3rem; margin-bottom: .5rem; }
.market-notice h3 { font-size: 1.3rem; font-weight: 900; color: var(--yolk); margin-bottom: .5rem; }
.market-notice p { opacity: .75; line-height: 1.7; }

/* â”€â”€â”€ NFT DETAIL MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#modal-overlay {
  display: none;
  position: fixed; inset: 0; z-index: 200;
  background: rgba(30,12,0,.8);
  backdrop-filter: blur(8px);
  align-items: center; justify-content: center;
  padding: 1rem;
}
#modal-overlay.open { display: flex; }
.modal {
  background: linear-gradient(160deg, #4A2E10, #2A1500);
  border: 2px solid var(--coop-light);
  border-radius: var(--radius);
  max-width: 480px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,.6);
  animation: popIn .25s cubic-bezier(.34,1.56,.64,1);
}
@keyframes popIn {
  from { transform: scale(.88); opacity: 0; }
  to   { transform: scale(1);   opacity: 1; }
}
.modal-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 1.2rem 1.5rem;
  border-bottom: 1px solid var(--coop-mid);
}
.modal-header h3 { font-size: 1.15rem; font-weight: 900; color: var(--yolk); }
.modal-close {
  background: none; border: none; color: var(--straw);
  font-size: 1.4rem; cursor: pointer; line-height: 1;
  transition: color .15s;
}
.modal-close:hover { color: var(--yolk); }
.modal-body { padding: 1.5rem; }
.modal-img {
  width: 100%; border-radius: var(--radius-sm);
  margin-bottom: 1rem;
  border: 2px solid var(--coop-mid);
}
.modal-img-placeholder {
  width: 100%; aspect-ratio: 1;
  display: flex; align-items: center; justify-content: center;
  font-size: 5rem;
  background: var(--coop-brown);
  border-radius: var(--radius-sm);
  margin-bottom: 1rem;
  border: 2px solid var(--coop-mid);
}
.modal-attrs {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: .5rem; margin-bottom: 1rem;
}
.attr-pill {
  background: rgba(245,166,35,.1);
  border: 1px solid rgba(245,166,35,.2);
  border-radius: var(--radius-sm);
  padding: .5rem .75rem;
  font-family: var(--font-mono);
}
.attr-pill .attr-type {
  font-size: .65rem; letter-spacing: .06em; text-transform: uppercase;
  color: var(--straw); margin-bottom: .2rem;
}
.attr-pill .attr-val { font-size: .88rem; color: var(--shell); font-weight: 700; }
.modal-desc { font-size: .88rem; color: var(--straw); line-height: 1.7; margin-bottom: 1rem; }
.modal-link {
  display: inline-block;
  font-family: var(--font-mono);
  font-size: .78rem;
  color: var(--yolk);
  text-decoration: none;
  border: 1px solid rgba(245,166,35,.3);
  padding: .35rem .75rem;
  border-radius: 999px;
  transition: all .2s;
  margin-top: .25rem;
}
.modal-link:hover { background: rgba(245,166,35,.15); border-color: var(--yolk); }

/* â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
footer {
  display: flex; align-items: center; justify-content: center; gap: 2rem;
  padding: 1rem 2rem;
  border-top: 1px solid rgba(160,98,42,.3);
  font-family: var(--font-mono);
  font-size: .74rem;
  color: var(--coop-light);
  flex-wrap: wrap;
}
footer a { color: var(--yolk); text-decoration: none; }
footer a:hover { text-decoration: underline; }

/* â”€â”€â”€ CHAIN BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chain-badge {
  display: inline-flex; align-items: center; gap: .4rem;
  background: rgba(245,166,35,.12);
  border: 1px solid rgba(245,166,35,.25);
  padding: .2rem .65rem;
  border-radius: 999px;
  font-family: var(--font-mono);
  font-size: .72rem;
  color: var(--straw);
  white-space: nowrap;
}
.chain-badge .chain-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 5px var(--green);
}
</style>
</head>
<body>

<!-- Floating ambient feathers/eggs -->
<div class="floaters" id="floaters"></div>

<div id="app">
  <!-- â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header>
    <div class="logo">
      <div class="logo-egg">ğŸ¥š</div>
      <div class="logo-text">
        <h1>HenVerse</h1>
        <p>EGG MINING Â· THE GROTTO</p>
      </div>
    </div>

    <nav>
      <button class="nav-btn active" onclick="switchTab('coop')">ğŸ” My Coop</button>
      <button class="nav-btn" onclick="switchTab('tokenomics')">ğŸ“Š Tokenomics</button>
      <button class="nav-btn" onclick="switchTab('market')">ğŸ›’ Market</button>
    </nav>

    <div class="wallet-zone">
      <div class="chain-badge">
        <span class="chain-dot"></span>
        The Grotto
      </div>
      <div id="wallet-badge">
        <span class="dot"></span>
        <span id="wallet-addr"></span>
      </div>
      <button id="connect-btn" onclick="connectWallet()">Connect Wallet</button>
    </div>
  </header>

  <!-- â”€â”€â”€ STATUS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="status-bar"></div>

  <!-- â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main>

    <!-- COOP TAB -->
    <div id="tab-coop" class="tab-panel active">
      <div class="facility-card">
        <h2>ğŸ¡ Your Hen Coop</h2>
        <!-- Coop SVG illustration -->
        <div class="facility-art">
          <svg viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
            <!-- Sky -->
            <rect width="400" height="300" fill="#D0EAF8"/>
            <!-- Ground -->
            <rect y="220" width="400" height="80" fill="#5B8C3E"/>
            <rect y="200" width="400" height="30" fill="#7AB050"/>
            <!-- Coop body -->
            <rect x="60" y="100" width="260" height="130" rx="4" fill="#8B5A2B"/>
            <rect x="65" y="105" width="250" height="120" rx="3" fill="#A0622A"/>
            <!-- Roof -->
            <polygon points="40,105 200,30 360,105" fill="#6B3A1F"/>
            <polygon points="50,105 200,38 350,105" fill="#8B4513"/>
            <!-- Roof ridge -->
            <line x1="200" y1="32" x2="200" y2="105" stroke="#6B3A1F" stroke-width="3"/>
            <!-- Roof tiles pattern -->
            <g opacity="0.2">
              <line x1="120" y1="105" x2="155" y2="60" stroke="#3D2008" stroke-width="1.5"/>
              <line x1="160" y1="105" x2="178" y2="47" stroke="#3D2008" stroke-width="1.5"/>
              <line x1="200" y1="105" x2="200" y2="38" stroke="#3D2008" stroke-width="1.5"/>
              <line x1="240" y1="105" x2="222" y2="47" stroke="#3D2008" stroke-width="1.5"/>
              <line x1="280" y1="105" x2="245" y2="60" stroke="#3D2008" stroke-width="1.5"/>
            </g>
            <!-- Door -->
            <rect x="172" y="165" width="56" height="65" rx="6" fill="#3D2008"/>
            <rect x="175" y="168" width="50" height="59" rx="4" fill="#2A1400"/>
            <circle cx="218" cy="198" r="3" fill="#F5A623"/>
            <!-- Windows -->
            <rect x="82" y="122" width="60" height="50" rx="4" fill="#3D2008"/>
            <rect x="85" y="125" width="54" height="44" rx="3" fill="#87CEEB" opacity="0.8"/>
            <line x1="112" y1="125" x2="112" y2="169" stroke="#3D2008" stroke-width="2"/>
            <line x1="85"  y1="147" x2="139" y2="147" stroke="#3D2008" stroke-width="2"/>

            <rect x="252" y="122" width="60" height="50" rx="4" fill="#3D2008"/>
            <rect x="255" y="125" width="54" height="44" rx="3" fill="#87CEEB" opacity="0.8"/>
            <line x1="282" y1="125" x2="282" y2="169" stroke="#3D2008" stroke-width="2"/>
            <line x1="255" y1="147" x2="309" y2="147" stroke="#3D2008" stroke-width="2"/>

            <!-- Fence left -->
            <rect x="10" y="195" width="55" height="8" rx="2" fill="#8B5A2B"/>
            <rect x="15" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <rect x="35" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <rect x="55" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <!-- Fence right -->
            <rect x="340" y="195" width="55" height="8" rx="2" fill="#8B5A2B"/>
            <rect x="340" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <rect x="360" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <rect x="380" y="175" width="8" height="30" rx="2" fill="#8B5A2B"/>
            <!-- Chickens -->
            <!-- Chicken 1 -->
            <ellipse cx="330" cy="218" rx="18" ry="14" fill="#F5F5DC"/>
            <circle cx="346" cy="210" r="9" fill="#F5F5DC"/>
            <ellipse cx="351" cy="208" rx="4" ry="3" fill="#FF6B6B"/>
            <polygon points="356,210 362,212 356,214" fill="#F5A623"/>
            <circle cx="353" cy="208" r="1.5" fill="#2A1400"/>
            <!-- Chicken 2 -->
            <ellipse cx="60" cy="218" rx="16" ry="13" fill="#FFF8DC"/>
            <circle cx="44" cy="210" r="8" fill="#FFF8DC"/>
            <ellipse cx="39" cy="208" rx="3.5" ry="2.5" fill="#FF6B6B"/>
            <polygon points="34,210 28,212 34,214" fill="#F5A623"/>
            <circle cx="37" cy="208" r="1.5" fill="#2A1400"/>
            <!-- Eggs on ground -->
            <ellipse cx="160" cy="225" rx="8" ry="6" fill="#FFF8DC" stroke="#E8C97A" stroke-width="1"/>
            <ellipse cx="175" cy="230" rx="7" ry="5.5" fill="#F5EAC5" stroke="#E8C97A" stroke-width="1"/>
            <ellipse cx="240" cy="227" rx="8" ry="6" fill="#FFF8DC" stroke="#E8C97A" stroke-width="1"/>
            <!-- Sun -->
            <circle cx="360" cy="45" r="22" fill="#F5A623" opacity="0.9"/>
            <g stroke="#F5A623" stroke-width="2" opacity="0.6">
              <line x1="360" y1="15" x2="360" y2="8"/>
              <line x1="360" y1="75" x2="360" y2="82"/>
              <line x1="330" y1="45" x2="323" y2="45"/>
              <line x1="390" y1="45" x2="397" y2="45"/>
              <line x1="339" y1="24" x2="334" y2="19"/>
              <line x1="381" y1="66" x2="386" y2="71"/>
              <line x1="381" y1="24" x2="386" y2="19"/>
              <line x1="339" y1="66" x2="334" y2="71"/>
            </g>
          </svg>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-box">
            <div class="label">Hens Owned</div>
            <div class="value" id="stat-hens">â€”</div>
          </div>
          <div class="stat-box">
            <div class="label">Placed in Coop</div>
            <div class="value" id="stat-placed">0</div>
          </div>
          <div class="stat-box">
            <div class="label">Hashrate</div>
            <div class="value" id="stat-hashrate">0 MH/s</div>
          </div>
          <div class="stat-box">
            <div class="label">Power</div>
            <div class="value" id="stat-power">0W</div>
          </div>
        </div>

        <!-- Power Bar -->
        <div class="power-bar-wrap">
          <div class="power-bar-label">
            <span>Power Usage</span>
            <span id="power-label-val">0 / 2000W</span>
          </div>
          <div class="power-bar-track">
            <div class="power-bar-fill" id="power-bar" style="width:0%"></div>
          </div>
        </div>

        <div id="no-wallet-msg" style="text-align:center;color:var(--straw);font-size:.85rem;padding:.5rem 0;opacity:.7;">
          Connect your wallet to manage your coop
        </div>

        <button class="coop-btn secondary" id="refresh-nfts-btn" style="display:none" onclick="loadNFTs()">
          â†» Refresh Hens
        </button>
      </div>

      <!-- NFT Grid Panel -->
      <div class="nft-section">
        <div class="nft-controls">
          <div>
            <div class="section-title" style="margin-bottom:.25rem;">
              <span>ğŸ£</span> HenVerse NFTs
            </div>
            <div class="nft-count" id="nft-count-label">Connect wallet to see your hens</div>
          </div>
          <button class="refresh-btn" id="refresh-btn" onclick="loadNFTs()" style="display:none">â†» Refresh</button>
        </div>

        <div class="nft-grid" id="nft-grid">
          <div class="empty-state">
            <div class="big">ğŸšï¸</div>
            <p>Connect your wallet to see your HenVerse hens</p>
          </div>
        </div>
      </div>
    </div>

    <!-- TOKENOMICS TAB -->
    <div id="tab-tokenomics" class="tab-panel">
      <div class="section-title"><span>ğŸ“Š</span> EGG Token Tokenomics</div>
      <div class="toko-grid">
        <div class="toko-card">
          <h3>Max Supply</h3>
          <div class="big-num">21,000,000</div>
          <div class="sub-num">EGG â€” fixed hard cap</div>
        </div>
        <div class="toko-card">
          <h3>Premine / Team</h3>
          <div class="big-num" style="color:var(--green)">None</div>
          <div class="sub-num">100% gameplay emissions</div>
        </div>
        <div class="toko-card">
          <h3>Base Emission Rate</h3>
          <div class="big-num">2.5</div>
          <div class="sub-num">EGG per block</div>
        </div>
        <div class="toko-card">
          <h3>Halving Interval</h3>
          <div class="big-num">4.2M</div>
          <div class="sub-num">blocks â‰ˆ 48 days</div>
        </div>
        <div class="toko-card">
          <h3>Referral Fee</h3>
          <div class="big-num">2.5%</div>
          <div class="sub-num">of claimed rewards</div>
        </div>
        <div class="toko-card">
          <h3>Network</h3>
          <div class="big-num" style="font-size:1.2rem">The Grotto</div>
          <div class="sub-num">Chain ID 36463 Â· Avalanche L1</div>
        </div>
      </div>

      <div class="section-title" style="margin-top:1.5rem"><span>â³</span> Emission Schedule</div>
      <div style="background:linear-gradient(160deg,rgba(107,58,31,.7),rgba(61,32,8,.9));border:1.5px solid var(--coop-mid);border-radius:var(--radius);padding:1.2rem;overflow-x:auto;">
        <table class="emission-table" id="emission-table">
          <thead>
            <tr>
              <th>Era</th>
              <th>Blocks</th>
              <th>Rate (EGG/block)</th>
              <th>Era Supply</th>
              <th>Cumulative</th>
              <th>â‰ˆ Days</th>
            </tr>
          </thead>
          <tbody id="emission-tbody"></tbody>
        </table>
      </div>

      <div class="section-title" style="margin-top:1.5rem"><span>ğŸ”</span> Reward Flywheel</div>
      <div style="background:linear-gradient(160deg,rgba(107,58,31,.7),rgba(61,32,8,.9));border:1.5px solid var(--coop-mid);border-radius:var(--radius);padding:1.4rem;">
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:1rem;">
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">1ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Buy a Coop</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Purchase a starter Hen Coop facility. You must own a coop before placing hens.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">2ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Place Hens</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Place HenVerse NFTs into your coop grid. Each hen adds hashrate to your total. Unplaced hens earn nothing.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">3ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Earn EGG</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Your share of each block emission = your hashrate Ã· total network hashrate Ã— 2.5 EGG.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">4ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Claim Rewards</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Manually claim accrued EGG. Utility fee deducted on claim. Keep pending rewards above fee threshold.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">5ï¸âƒ£</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">Upgrade or Trade</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">Upgrade your coop for more slots & power. Trade hens on the marketplace. Refer friends for 2.5% of their claims.</div>
          </div>
          <div style="padding:.9rem;background:rgba(245,166,35,.07);border:1px solid rgba(245,166,35,.18);border-radius:10px;">
            <div style="font-size:1.5rem;margin-bottom:.4rem">â™»ï¸</div>
            <div style="font-weight:900;color:var(--yolk);margin-bottom:.3rem">The Flywheel</div>
            <div style="font-size:.83rem;color:var(--straw);line-height:1.6">EGG earned â†’ buy more hens / upgrades â†’ more hashrate â†’ more EGG. Halvings create scarcity pressure driving token value.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- MARKET TAB -->
    <div id="tab-market" class="tab-panel">
      <div class="section-title"><span>ğŸ›’</span> Hen Market</div>
      <div class="market-notice">
        <div class="big">ğŸš§</div>
        <h3>Marketplace Coming Soon</h3>
        <p>Trade your HenVerse hens peer-to-peer.<br/>
        The marketplace will let you list, buy, and cancel NFT listings directly onchain.<br/><br/>
        In the meantime, you can mint your hens at the contract below and view them in your coop.</p>
        <br/>
        <a class="modal-link" href="https://explorer.avax.network/thegrotto/address/0x42c302FF8c34bb5D19bDA1a051bA89BD3a23b7CF" target="_blank" rel="noreferrer">View NFT Contract â†—</a>
      </div>

      <div class="section-title" style="margin-top:2rem"><span>ğŸ”</span> Hen Types</div>
      <div style="background:linear-gradient(160deg,rgba(107,58,31,.7),rgba(61,32,8,.9));border:1.5px solid var(--coop-mid);border-radius:var(--radius);padding:1.2rem;overflow-x:auto;">
        <table class="emission-table">
          <thead>
            <tr>
              <th>Hen Type</th>
              <th>Hashrate</th>
              <th>Power</th>
              <th>Cost (EGG)</th>
              <th>Supply</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>ğŸ£ Chick (Starter)</td><td class="highlight">10 MH/s</td><td>100W</td><td>500 EGG</td><td>2,000</td></tr>
            <tr><td>ğŸ” Standard Hen</td><td class="highlight">24 MH/s</td><td>200W</td><td>1,500 EGG</td><td>500</td></tr>
            <tr><td>ğŸ¦… Golden Hen</td><td class="highlight">70 MH/s</td><td>600W</td><td>4,000 EGG</td><td>30</td></tr>
            <tr><td>ğŸ¦š Legendary Rooster</td><td class="highlight">200 MH/s</td><td>1000W</td><td>5,000 EGG</td><td>20</td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </main>

  <!-- â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <footer>
    <span>HenVerse Â© 2025</span>
    <a href="https://explorer.avax.network/thegrotto" target="_blank" rel="noreferrer">Explorer â†—</a>
    <span>Chain ID: 36463</span>
    <span>NFT: 0x42c3â€¦b7CF</span>
  </footer>
</div>

<!-- â”€â”€â”€ NFT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="modal-overlay" onclick="closeModal(event)">
  <div class="modal" id="nft-modal">
    <div class="modal-header">
      <h3 id="modal-name">Hen #0</h3>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="modal-img-wrap"></div>
      <p class="modal-desc" id="modal-desc"></p>
      <div class="modal-attrs" id="modal-attrs"></div>
      <a class="modal-link" id="modal-explorer-link" href="#" target="_blank" rel="noreferrer">View on Explorer â†—</a>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CHAIN_ID     = 36463;
const CHAIN_HEX    = '0x' + CHAIN_ID.toString(16); // 0x8E6F
const RPC_URL      = 'https://subnets.avax.network/thegrotto/mainnet/rpc';
const EXPLORER     = 'https://explorer.avax.network/thegrotto';
const NFT_CONTRACT = '0x42c302FF8c34bb5D19bDA1a051bA89BD3a23b7CF';

// â”€â”€â”€ EMISSION CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BASE_EMISSION   = 2.5;      // EGG per block
const HALVING_INTERVAL = 4_200_000; // blocks
const MAX_SUPPLY      = 21_000_000;
const BLOCKS_PER_DAY  = 86400;    // ~1 block/sec on Grotto

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let walletAddr    = null;
let userNFTs      = [];
let placedNFTs    = new Set();
let isFetching    = false;

// â”€â”€â”€ FLOATERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function spawnFloaters() {
  const wrap   = document.getElementById('floaters');
  const icons  = ['ğŸ¥š','ğŸª¶','ğŸ“','ğŸ£','ğŸŒ¾','âœ¨'];
  for (let i = 0; i < 14; i++) {
    const el = document.createElement('div');
    el.className = 'floater';
    el.textContent = icons[i % icons.length];
    el.style.left     = Math.random() * 100 + 'vw';
    el.style.animationDuration = (14 + Math.random() * 18) + 's';
    el.style.animationDelay   = '-' + Math.random() * 25 + 's';
    el.style.fontSize = (.9 + Math.random() * .9) + 'rem';
    wrap.appendChild(el);
  }
})();

// â”€â”€â”€ TAB SWITCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(name) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  // match button by text pattern
  document.querySelectorAll('.nav-btn').forEach(b => {
    if (b.getAttribute('onclick').includes(name)) b.classList.add('active');
  });
}

// â”€â”€â”€ STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setStatus(msg, isError = false) {
  const bar = document.getElementById('status-bar');
  if (!msg) { bar.classList.remove('visible','error'); bar.textContent = ''; return; }
  bar.textContent = msg;
  bar.classList.toggle('error', isError);
  bar.classList.add('visible');
}

// â”€â”€â”€ RPC CALL (no external lib) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function rpcCall(method, params = []) {
  const res = await fetch(RPC_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ jsonrpc: '2.0', id: Date.now(), method, params }),
  });
  const json = await res.json();
  if (json.error) throw new Error(json.error.message || 'RPC error');
  return json.result;
}

// â”€â”€â”€ TINY ABI ENCODER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Known function selectors (keccak256 first 4 bytes)
const SEL = {
  'balanceOf(address)':             '70a08231',
  'tokenOfOwnerByIndex(address,uint256)': '2f745c59',
  'tokenURI(uint256)':              'c87b56dd',
  'totalSupply()':                  '18160ddd',
  'ownerOf(uint256)':               '6352211e',
  'name()':                         '06fdde03',
  'symbol()':                       '95d89b41',
};

function encodeFn(sig, ...args) {
  const sel = SEL[sig];
  if (!sel) throw new Error('Unknown selector: ' + sig);
  let data = sel;
  const types = (sig.match(/\(([^)]*)\)/)?.[1] || '').split(',').filter(Boolean);
  args.forEach((arg, i) => {
    const t = types[i]?.trim();
    if (t === 'address') {
      data += arg.toLowerCase().replace('0x','').padStart(64,'0');
    } else if (t === 'uint256') {
      data += BigInt(arg).toString(16).padStart(64,'0');
    }
  });
  return '0x' + data;
}

async function ethCall(sig, ...args) {
  const data = encodeFn(sig, ...args);
  return rpcCall('eth_call', [{ to: NFT_CONTRACT, data }, 'latest']);
}

// â”€â”€â”€ ABI DECODER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function decodeUint256(hex) {
  if (!hex || hex === '0x') return 0n;
  return BigInt(hex.slice(0,2) === '0x' ? hex : '0x' + hex);
}

function decodeString(hex) {
  try {
    if (!hex || hex === '0x') return '';
    const h = hex.startsWith('0x') ? hex.slice(2) : hex;
    if (h.length < 128) return '';
    // ABI string: slot0 = offset (usually 0x20 = 32), slot1 = length, then bytes
    const offset = Number(BigInt('0x' + h.slice(0,64))) * 2;
    const length = Number(BigInt('0x' + h.slice(offset, offset + 64)));
    if (length === 0) return '';
    const strHex = h.slice(offset + 64, offset + 64 + length * 2);
    let str = '';
    for (let i = 0; i < strHex.length; i += 2) {
      str += String.fromCharCode(parseInt(strHex.slice(i, i + 2), 16));
    }
    return str;
  } catch { return ''; }
}

// â”€â”€â”€ IPFS / URI helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resolveURI(uri) {
  if (!uri) return '';
  if (uri.startsWith('ipfs://')) return 'https://ipfs.io/ipfs/' + uri.slice(7);
  if (uri.startsWith('ipfs/'))   return 'https://ipfs.io/ipfs/' + uri.slice(5);
  return uri;
}

async function fetchMetadata(uri) {
  try {
    if (uri.startsWith('data:application/json;base64,')) {
      return JSON.parse(atob(uri.split(',')[1]));
    }
    if (uri.startsWith('data:application/json,')) {
      return JSON.parse(decodeURIComponent(uri.split(',')[1]));
    }
    const url = resolveURI(uri);
    if (!url) return null;
    const r = await fetch(url, { signal: AbortSignal.timeout(8000) });
    if (!r.ok) return null;
    return await r.json();
  } catch { return null; }
}

// â”€â”€â”€ CONNECT WALLET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function connectWallet() {
  if (!window.ethereum) {
    return setStatus('No wallet detected â€” please install MetaMask.', true);
  }
  setStatus('Connectingâ€¦');
  try {
    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    if (!accounts.length) { setStatus('No accounts found.', true); return; }
    walletAddr = accounts[0];

    // Ensure correct chain
    const currentChain = await window.ethereum.request({ method: 'eth_chainId' });
    if (parseInt(currentChain, 16) !== CHAIN_ID) {
      setStatus('Switching to The Grotto networkâ€¦');
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: CHAIN_HEX }],
        });
      } catch (switchErr) {
        if (switchErr.code === 4902) {
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: CHAIN_HEX,
              chainName: 'The Grotto',
              rpcUrls: [RPC_URL],
              blockExplorerUrls: [EXPLORER],
              nativeCurrency: { name: 'GRT', symbol: 'GRT', decimals: 18 },
            }],
          });
        } else {
          throw switchErr;
        }
      }
    }

    onWalletConnected(walletAddr);
  } catch (e) {
    setStatus(e.message || 'Failed to connect wallet.', true);
  }
}

function onWalletConnected(addr) {
  walletAddr = addr;
  // Update UI
  document.getElementById('connect-btn').style.display = 'none';
  const badge = document.getElementById('wallet-badge');
  badge.style.display = 'flex';
  document.getElementById('wallet-addr').textContent =
    addr.slice(0,6) + 'â€¦' + addr.slice(-4);
  document.getElementById('no-wallet-msg').style.display = 'none';
  document.getElementById('refresh-nfts-btn').style.display = 'block';
  document.getElementById('refresh-btn').style.display = 'inline-block';
  setStatus('');
  loadNFTs();
}

// Handle chain / account changes
if (window.ethereum) {
  window.ethereum.on('accountsChanged', (accs) => {
    if (accs.length) onWalletConnected(accs[0]);
    else window.location.reload();
  });
  window.ethereum.on('chainChanged', () => window.location.reload());
}

// â”€â”€â”€ LOAD NFTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadNFTs() {
  if (!walletAddr || isFetching) return;
  isFetching = true;
  setStatus('Fetching your HenVerse hens from The Grottoâ€¦');

  // Spinner
  const refreshBtn = document.getElementById('refresh-btn');
  const refreshBtn2 = document.getElementById('refresh-nfts-btn');
  refreshBtn.classList.add('spinning');

  const grid = document.getElementById('nft-grid');
  grid.innerHTML = '';

  // Skeleton placeholders
  for (let i = 0; i < 4; i++) {
    const sk = document.createElement('div');
    sk.className = 'skeleton';
    grid.appendChild(sk);
  }

  try {
    // 1. Total supply
    const tsHex = await ethCall('totalSupply()');
    const totalSupply = Number(decodeUint256(tsHex));

    // 2. User balance
    const balHex = await ethCall('balanceOf(address)', walletAddr);
    const balance = Number(decodeUint256(balHex));

    document.getElementById('stat-hens').textContent = balance;
    document.getElementById('nft-count-label').innerHTML =
      `You own <strong>${balance}</strong> hen${balance !== 1 ? 's' : ''}
       &nbsp;Â·&nbsp; <span style="opacity:.6">${totalSupply} total minted</span>`;

    userNFTs = [];

    if (balance === 0) {
      grid.innerHTML = '';
      const empty = document.createElement('div');
      empty.className = 'empty-state';
      empty.innerHTML = '<div class="big">ğŸ£</div><p>No HenVerse hens in this wallet yet.<br/>Mint some to get started!</p>';
      grid.appendChild(empty);
      setStatus('');
      updateCoopStats();
      return;
    }

    // 3. Fetch token IDs
    const tokenPromises = [];
    for (let i = 0; i < balance; i++) {
      tokenPromises.push(
        ethCall('tokenOfOwnerByIndex(address,uint256)', walletAddr, i)
          .then(hex => Number(decodeUint256(hex)))
      );
    }
    const tokenIds = await Promise.all(tokenPromises);

    // 4. Fetch tokenURIs + metadata (parallel, with concurrency limit)
    const CONCURRENCY = 4;
    const nfts = [];
    for (let i = 0; i < tokenIds.length; i += CONCURRENCY) {
      const batch = tokenIds.slice(i, i + CONCURRENCY);
      const results = await Promise.all(batch.map(async (id) => {
        let metadata = null;
        try {
          const uriHex = await ethCall('tokenURI(uint256)', id);
          const uri    = decodeString(uriHex);
          metadata     = await fetchMetadata(uri);
        } catch {}
        return { tokenId: id, metadata };
      }));
      nfts.push(...results);
    }
    userNFTs = nfts;

    // 5. Render grid
    grid.innerHTML = '';
    nfts.forEach(nft => {
      grid.appendChild(createNFTCard(nft));
    });

    updateCoopStats();
    setStatus('');
  } catch (e) {
    grid.innerHTML = '';
    const errEl = document.createElement('div');
    errEl.className = 'empty-state';
    errEl.innerHTML = '<div class="big">âš ï¸</div><p>Failed to load hens: ' + escHtml(e.message) + '</p>';
    grid.appendChild(errEl);
    setStatus('Error loading NFTs: ' + e.message, true);
  } finally {
    isFetching = false;
    refreshBtn.classList.remove('spinning');
  }
}

// â”€â”€â”€ CREATE NFT CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function createNFTCard(nft) {
  const { tokenId, metadata } = nft;
  const card = document.createElement('div');
  card.className = 'nft-card' + (placedNFTs.has(tokenId) ? ' selected' : '');
  card.onclick = () => openModal(nft);

  const name  = metadata?.name  || `Hen #${tokenId}`;
  const image = resolveURI(metadata?.image || metadata?.image_url || '');

  let imgHtml;
  if (image) {
    imgHtml = `<img src="${escAttr(image)}" alt="${escAttr(name)}"
      onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"/>
      <div class="nft-img-placeholder" style="display:none;aspect-ratio:1">ğŸ”</div>`;
  } else {
    imgHtml = `<div class="nft-img-placeholder">ğŸ”</div>`;
  }

  const badge = placedNFTs.has(tokenId)
    ? '<div class="nft-badge placed">In Coop</div>'
    : '<div class="nft-badge">Wallet</div>';

  card.innerHTML = `
    ${badge}
    ${imgHtml}
    <div class="nft-info">
      <div class="nft-name">${escHtml(name)}</div>
      <div class="nft-id">#${tokenId}</div>
    </div>
  `;
  return card;
}

// â”€â”€â”€ OPEN NFT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(nft) {
  const { tokenId, metadata } = nft;
  const name  = metadata?.name  || `Hen #${tokenId}`;
  const image = resolveURI(metadata?.image || metadata?.image_url || '');
  const desc  = metadata?.description || '';
  const attrs = metadata?.attributes || metadata?.traits || [];

  document.getElementById('modal-name').textContent = name;

  // Image
  const imgWrap = document.getElementById('modal-img-wrap');
  if (image) {
    imgWrap.innerHTML = `<img class="modal-img" src="${escAttr(image)}" alt="${escAttr(name)}"
      onerror="this.outerHTML='<div class=\\'modal-img-placeholder\\'>ğŸ”</div>'"/>`;
  } else {
    imgWrap.innerHTML = `<div class="modal-img-placeholder">ğŸ”</div>`;
  }

  // Description
  document.getElementById('modal-desc').textContent = desc;

  // Attributes
  const attrsEl = document.getElementById('modal-attrs');
  if (Array.isArray(attrs) && attrs.length) {
    attrsEl.innerHTML = attrs.slice(0,8).map(a => `
      <div class="attr-pill">
        <div class="attr-type">${escHtml(String(a.trait_type || a.name || ''))}</div>
        <div class="attr-val">${escHtml(String(a.value || ''))}</div>
      </div>
    `).join('');
  } else {
    attrsEl.innerHTML = '';
  }

  // Explorer link
  document.getElementById('modal-explorer-link').href =
    `${EXPLORER}/token/${NFT_CONTRACT}?tokenId=${tokenId}`;

  document.getElementById('modal-overlay').classList.add('open');
}

function closeModal(e) {
  if (e && e.target !== document.getElementById('modal-overlay')) return;
  document.getElementById('modal-overlay').classList.remove('open');
}

// â”€â”€â”€ COOP STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Approximate hen stats â€” will be driven by contract later
const HEN_STATS = {
  default: { hashrate: 10, power: 100 }  // MH/s, W per hen NFT
};

function updateCoopStats() {
  const placed = placedNFTs.size;
  const hashrate = placed * HEN_STATS.default.hashrate;
  const power    = placed * HEN_STATS.default.power;
  const capacity = 2000; // W starter coop

  document.getElementById('stat-placed').textContent   = placed;
  document.getElementById('stat-hashrate').textContent = hashrate + ' MH/s';
  document.getElementById('stat-power').textContent    = power + 'W';
  document.getElementById('power-label-val').textContent = power + ' / ' + capacity + 'W';

  const pct = Math.min(100, (power / capacity) * 100);
  const bar = document.getElementById('power-bar');
  bar.style.width = pct + '%';
  bar.className = 'power-bar-fill' +
    (pct > 85 ? ' danger' : pct > 60 ? ' warn' : '');
}

// â”€â”€â”€ EMISSION SCHEDULE TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function buildEmissionTable() {
  const tbody = document.getElementById('emission-tbody');
  let cumulative = 0;
  let rate = BASE_EMISSION;
  let rows = '';

  for (let era = 1; era <= 8; era++) {
    if (cumulative >= MAX_SUPPLY) break;
    const eraSupply = Math.min(rate * HALVING_INTERVAL, MAX_SUPPLY - cumulative);
    cumulative += eraSupply;
    const days = Math.round((HALVING_INTERVAL / BLOCKS_PER_DAY));

    // Estimate if this is the current era (just mark era 1 as current for now)
    const isCurrentEra = era === 1;
    rows += `<tr class="${isCurrentEra ? 'current-era' : ''}">
      <td>${isCurrentEra ? 'âš¡ ' : ''}Era ${era}</td>
      <td class="highlight">${(HALVING_INTERVAL * (era-1)).toLocaleString()} â€“ ${(HALVING_INTERVAL * era).toLocaleString()}</td>
      <td>${rate.toFixed(4)} EGG/block</td>
      <td>${eraSupply.toLocaleString(undefined, {maximumFractionDigits:0})} EGG</td>
      <td>${cumulative.toLocaleString(undefined, {maximumFractionDigits:0})} EGG</td>
      <td>~${days}d</td>
    </tr>`;
    rate /= 2;
  }
  tbody.innerHTML = rows;
})();

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function escAttr(s) {
  return String(s).replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}
</script>
</body>
</html>
